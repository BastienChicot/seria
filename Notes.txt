Modèle pertinent :

Ce qu'on veut montrer == nombre de frappes / buts par equipe et donc victoire et défaite

variables explicatives qui ont du sens  : 
	- possession (encore que ?) --> FBREF
	- contre attaque 
	- formation --> FBREF
	- coach     === ces deux derniers ont pour but de montrer le style de jeu et peut-être expliqueront-ils les occasions --TRANSFERMARKT
	- effectifs == valeur de l'effectif c'est un peu le seul truc que je peux avoir (notes fifa ?) --TRANSFERMARKT
	- fautes subies ou penaltys+coup francs == aggressivité, capacité à provoquer la faute (trop de faute provoquée s'expliquerait peut-être par une différence de niveau forte entre les équipes) --> FBREF
	- saves du gardien (par match ou par équipe ?) --> expliquerait la part liée au gardien !! ATTENTION cependant à ce que ça ne soit pas trop corrélé avec le nombre de frappes mais, expliquerait peut-être la qualité offensive d'une équipe ???
	- Forme == le repos est il pertinent entre deux matchs (sachant que dans le foot, peu d'équipe jouent plus de 2 matchs par semaine) et série en cours (aspect psychologique de l'équipe) --> A recalculer
	- age moyen de l'équipe == capacité à jouer fort contrebalancée par l'expérience , qui a le plus d'effet ? --> TRANSFERMARKT??
	- Période de l'année (certains joueurs plus endurants dans le froid ou plus performant dans le chaud ???) --> PARTOUT EN VRAI
	- Si possible, nombre de passes moyen par match ? mais pas sûr de la pertinence + doublon avec possession peut-être --> FBREF

Comment connaitre la valeur d'une équipe avant chaque match (avec les absents etc....) Le PSG sans neymar, Mbappé et Messi c'est toujours bien mais c'est moins fou ?
Attention à l'effet coach = 
La possession, le nombre de passe, le nombre de frappe, le nombre de save du gardien vont aussi dépendre du schéma de jeu. Par conséquent le fait d'introduire le coach et la formation de l'équipe dans l'équation pourrait créer une corrélation forte entre toutes ces variables .


Où trouver les données  ::
Problème de ESPN == URL avec des codes matchs sans logique évidente
Problème de Whoscored == Site protégé, impossible de scrapper 
Problème de récupérer les csv == Mise à jour ?
Problème des API == API complètes payantes
Problème de azscore ou xscore je sais plus == url avec logique d'id de match random comme espn 

Dans les csv de football-data.co.uk :
Equipes
Date
Nb de buts
Nb de tirs
Nb de tirs cadrés
Résultat
Fautes
Corner
Jaunes
Rouges

fbref !!! YOUHOU !!! mais pb d'url encore
codes url dans un fichier text

Dans les fichiers fbref scores & fixtures:
Date
Heure
Equipe
compétition
Home/Away
Résultat
Nombre de buts
Nombre de buts encaissés
Possession
Attendance
Capitaine
Formation Arbitre

Dans les fichiers fbref shoots:
Tirs
Tirs cadrés
Distance moyenne
Free kicks
Penaltys

Dans les fichiers fbref passing:
Passes complétées
% de passes réussies

Dans les fichiers defensive actions:
Tacles
interceptions

Dans les fichiers miscallenous stats:
Cartons jaunes
Cartons rouges
Fautes 
Hors jeu

Récup sur transfermarkt :
Galère == tables en js
Selenium plus retouches à la main pour obtenir un fichier correct et exploitable mais à ne faire qu'une fois par saison donc EZ


Comment exprimer concretement les variables :
Modèle ==>
Nombre de but / Victoire-Défaite = Date + Home/away + Possession + Formation + Tirs? + Distance moyenne + % de passes completées + interceptions + Tacles + Cartons + Fautes + Valeur equipe

Intégration de variable de l'adversaire ? --> Valeur equipe adverse , Formation equipe adverse

Nombre de buts ou Victoire == Resulat dans les bases FBREF

- Date == Ou période de l'année (peut-être ne garder que le mois / fonctionnait bien sur la NBA)
- Home/Away = Tel quel dans les bases FBREF
- Possession == Juste la possession de l'equipe (Voir s'il ne serait pas pertinent de la comparer avec la possession moyenne de la saison) dans FBREF
- Formation == Voir si il est bien pertinent de garder la formation sous forme de str --> Peut-être créer trois nouvelles variables = nb defenseurs, nb milieu, nb attaquants (seul problème, les formations type 4-2-3-1 mais peut être possible en faisant 11 - (nb_att + nb_def))
- Tirs : gros risque de corrélation avec la var a expliquée surtout si je garde le nombre de but. + tirs ou tirs cadrés ?
- Distance == FBREF, interessant mais potentiellement fortement correlée au nombre de tirs
- % de passes completées == tel quel dans FBREF
- interceptions == FBREF 
- Tacles == FBREF, voir la pertinence
- Cartons == Jaunes ou rouges ? voir pertinence également
- Fautes == soit cartons soit ça en gros
- valeur équipe == supprimer les caractères inutiles (€ et m)
- age
- valeur équipe adverse == idem
- formation équipe adverse == pareil (nb de défenseur etc...) 
- Nb de jours de repos == recalculer depuis FBREF

CORRELATION DES VARIABLES, OBSERVATIONS SUR LA SAISON 21 22 (a confirmer avec les données des autres saisons):
possession ==>
tirs cadrés : 0.39
cmp% : 0.57
repos : 0.46

age ==>
value : 0.18

tirs cardés ==>
possession : 0.39
cmp% : 0.33

distance ==>
tirs cadrés : 0.2

cmp% ==>
possession : 0.57
value : 0.47

int ==>
possession : -0.26
cmp% : -0.26

fls ==>
cmp% : -0.27

value ==> 
cmp% : 0.47

repos ==>
value : 0.17

opp_value ==>
possession : -0.38

VICTOIRE ==>
possession : 0.17
tirs cadrés : 0.41
cmp% : 0.18
value : 0.28
opp_value : -0.26 (s'annule avec la value) 

Il peut-être intéressant de travailler sur la différence de valeur plutôt que sur les valeurs directement

diff_value ==>
possession : 0.53
tirs cadrés : 0.33
cmp% : 0.34
VICTOIRE : 0.4

On garde la diff c'est mieux!
Test sur les équipes à domicile mais rien de fou 

le nombre de milieu et d'attaquant semble être plus corrélés à la victoire ou à la défaite(nul) que le nombre de défenseur. Voir avec la différence peut-être.

Pour les années précédente, je suis bloqué car je n'ai plus accès au site (access denied == robots). tester un autre jour ou sur un autre ordi. ==> j'ai été IP ban quelques temps car trop de requêtes en même temps. J'envoyais 3 URL quasi en même temps tous les 2 minutes du coup normal. CloudShare qui gere ça me renvoyait une erreur 1015 qui est un ban temporaire rien de grave. J'ai juste ajouter des time.sleep dans le script de scraping et je lance 1 année à la fois.

Matrice de corrélation pour les données de 2020 à 2023 :
Résultats les plus forts :
0.57 cmp% et possession
0.45 cmp% et value
0.39 victoire et tirs cadrés
0.45 diff value et possession
0.34 diff value et tirs cadrés
0.4 diff value et victoire
0.31 possession et tirs cadrés

Whatabout Victoire #ce qui nous intéresse
Majoritairement la valeur, les tirs cadrés, la possession et la distance moyenne de tir

Regressions tests:
Premier test : Explique la variable victoire

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1207
Model:                          Logit   Df Residuals:                     1193
Method:                           MLE   Df Model:                           13
Date:                Mon, 16 Jan 2023   Pseudo R-squ.:                  0.2226
Time:                        21:16:06   Log-Likelihood:                -616.79
converged:                       True   LL-Null:                       -793.43
Covariance Type:            nonrobust   LLR p-value:                 1.589e-67
===============================================================================
                  coef    std err          z      P>|z|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept      -0.2724   2.61e+07  -1.05e-08      1.000   -5.11e+07    5.11e+07
opp_att        -0.9054   2.61e+06  -3.48e-07      1.000   -5.11e+06    5.11e+06
opp_def        -0.9070   2.61e+06  -3.48e-07      1.000   -5.11e+06    5.11e+06
opp_milieu     -0.9117   2.61e+06   -3.5e-07      1.000   -5.11e+06    5.11e+06
home            0.3121      0.141      2.210      0.027       0.035       0.589
np.log(age)     2.7947      1.944      1.438      0.150      -1.015       6.604
Poss           -0.0635      0.010     -6.186      0.000      -0.084      -0.043
SoT             0.3157      0.034      9.220      0.000       0.249       0.383
Dist           -0.0141      0.025     -0.563      0.573      -0.063       0.035
Cmp             0.0175      0.015      1.174      0.240      -0.012       0.047
Int             0.0221      0.017      1.309      0.191      -0.011       0.055
Fls            -0.0044      0.019     -0.230      0.818      -0.042       0.033
diff_value      0.0044      0.000     11.186      0.000       0.004       0.005
repos           0.0032      0.013      0.236      0.813      -0.023       0.030
Mois            0.0089      0.019      0.481      0.631      -0.027       0.045
===============================================================================

Sans trop de surprise ce sont les différence de valeur, la possession et le nombre de tirs cadrés qui ressortent en premier. On note aussi un R² pas fou.
le log de l'age est bien plus significatif que lorsqu'il n'est pas en log
Du coup je teste les variables numériques en log (sauf peut etre home qui est déjà binaire et qui a plutot un bon score):

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1207
Model:                          Logit   Df Residuals:                     1184
Method:                           MLE   Df Model:                           22
Date:                Mon, 16 Jan 2023   Pseudo R-squ.:                  0.2272
Time:                        21:25:15   Log-Likelihood:                -613.15
converged:                       True   LL-Null:                       -793.43
Covariance Type:            nonrobust   LLR p-value:                 5.401e-63
======================================================================================
                         coef    std err          z      P>|z|      [0.025      0.975]
--------------------------------------------------------------------------------------
Intercept             -8.1381      9.765     -0.833      0.405     -27.278      11.002
C(Mois)[T.2]           0.0573      0.314      0.182      0.855      -0.558       0.673
C(Mois)[T.3]           0.3247      0.334      0.973      0.330      -0.329       0.979
C(Mois)[T.4]           0.2078      0.290      0.716      0.474      -0.361       0.777
C(Mois)[T.5]          -0.0973      0.307     -0.317      0.751      -0.699       0.504
C(Mois)[T.8]          -0.2688      0.364     -0.739      0.460      -0.982       0.444
C(Mois)[T.9]           0.3498      0.298      1.174      0.241      -0.234       0.934
C(Mois)[T.10]          0.3297      0.279      1.183      0.237      -0.217       0.876
C(Mois)[T.11]          0.4311      0.296      1.455      0.146      -0.149       1.012
C(Mois)[T.12]         -0.1853      0.306     -0.606      0.545      -0.785       0.414
np.log(opp_att)        0.4855      0.909      0.534      0.593      -1.297       2.268
np.log(opp_def)        0.8889      1.994      0.446      0.656      -3.019       4.797
np.log(opp_milieu)     1.0511      2.003      0.525      0.600      -2.875       4.977
home                   0.3078      0.142      2.170      0.030       0.030       0.586
np.log(age)            2.9373      1.952      1.504      0.132      -0.889       6.764
np.log(Poss)          -3.0161      0.499     -6.047      0.000      -3.994      -2.039
SoT                    0.3222      0.035      9.313      0.000       0.254       0.390
np.log(Dist)          -0.2960      0.441     -0.672      0.502      -1.160       0.568
np.log(Cmp)            1.2560      1.147      1.096      0.273      -0.991       3.503
np.log(Int)            0.2092      0.156      1.344      0.179      -0.096       0.514
np.log(Fls)           -0.0139      0.239     -0.058      0.954      -0.483       0.455
diff_value             0.0044      0.000     11.191      0.000       0.004       0.005
np.log(repos)          0.0417      0.138      0.302      0.762      -0.229       0.312
======================================================================================
"""
R² toujours aussi nul

- home est pas mal
- log d'age mouais
- Possession toujours nickel
- Sot toujours nickel aussi
- diff_value toujours nickel
- Mois de novembre giga intéressant
- Meilleur score pour le nb d'attaquant, defenseurs et milieu mais je me demande si je ne devrais pas plutôt travailler sur les différences par postes entre les formations 
- Int et Cmp peut-être quelque chose à creuser aussi
- Fautes et repos à chier

En Machine Learning je pourrais plus facilement faire des modèles en fonction des équipes (même si en vrai elle transparaissent à travers leurs valeurs)

A refaire : tester d'autres types de modèles avant de partir en ML 
Créer des variables pour différencier les formations sans partir sur des trucs catégoriels trop chiants
Voir s'il n'y a pas d'autres variables dans la base d'origine qui pourraient être intéressantes à exploiter (peut-être en en modifiant la forme)

Matrice de corrélation sur la table d'origine :
Shot - possession plus fort que tirs cadrés possession
FK free kick pas mal avec possession
Attempt (Att) plus fort que Cmp%
Yellow cards pas mal, red cards pas fou
Offside nul
Victoire : plus faible avec tirs qu'avec tirs cadrés, pas mal avec PK (penalty), meilleur avec Cmp% qu'avec Att, Yellow et red cards pareil et c'est pas mal.

On va ajouter PK, Shot, Att et les deux cards + je recalcul des diff entre post (att - defopp, def-attopp et milieu-milieuopp)
différence au milieu joue bien sur la possession par contre, c'est mieux que le nombre de milieu, de défenseur ou d'attaquant mais ça reste faiblard sur la victoire.

Nouvelle regression :
<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1197
Model:                          Logit   Df Residuals:                     1173
Method:                           MLE   Df Model:                           23
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2689
Time:                        21:01:52   Log-Likelihood:                -576.30
converged:                       True   LL-Null:                       -788.29
Covariance Type:            nonrobust   LLR p-value:                 2.021e-75
=================================================================================
                    coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept        -1.4344      7.706     -0.186      0.852     -16.539      13.670
C(Mois)[T.2]      0.0414      0.328      0.126      0.900      -0.601       0.684
C(Mois)[T.3]      0.3132      0.351      0.893      0.372      -0.374       1.000
C(Mois)[T.4]      0.1906      0.301      0.634      0.526      -0.398       0.780
C(Mois)[T.5]     -0.2097      0.321     -0.653      0.514      -0.840       0.420
C(Mois)[T.8]     -0.2137      0.379     -0.563      0.573      -0.957       0.530
C(Mois)[T.9]      0.3173      0.308      1.032      0.302      -0.285       0.920
C(Mois)[T.10]     0.3849      0.290      1.327      0.184      -0.184       0.953
C(Mois)[T.11]     0.3641      0.304      1.197      0.231      -0.232       0.960
C(Mois)[T.12]    -0.1458      0.310     -0.471      0.638      -0.753       0.461
diff_off          0.0209        nan        nan        nan         nan         nan
diff_def          0.0024        nan        nan        nan         nan         nan
diff_mil         -0.0233        nan        nan        nan         nan         nan
home              0.4094      0.150      2.730      0.006       0.115       0.703
np.log(age)       2.2240      2.026      1.098      0.272      -1.747       6.195
np.log(Poss)     -2.3274      0.533     -4.366      0.000      -3.372      -1.283
SoT               0.4631      0.047      9.933      0.000       0.372       0.554
np.log(Dist)     -0.5751      0.454     -1.266      0.205      -1.465       0.315
np.log(Cmp)       0.6353      1.174      0.541      0.588      -1.665       2.936
np.log(Int)       0.2176      0.162      1.340      0.180      -0.101       0.536
diff_value        0.0044      0.000     10.737      0.000       0.004       0.005
Sh               -0.0950      0.021     -4.565      0.000      -0.136      -0.054
PK                1.0607      0.191      5.566      0.000       0.687       1.434
CrdY             -0.0411      0.057     -0.717      0.474      -0.154       0.071
CrdR             -0.6325      0.242     -2.610      0.009      -1.107      -0.158
=================================================================================
"""

Toujours Octobre et Novembre, va savoir pourquoi ? Arrivé du froid, mise en route des équipes...
Pourquoi les diff par postes sont en nan ? A chercher...
home est très bien
log de l'age se défend, à voir dans un modèle plus petit
possession et tirs cadrés toujours au top
log d'int est défendable
diff value, shot et penalty kick sont cool
Red cards aussi

R² un peu mieux que sur les modèles précédents.

Un par un, diff milieu est celui qui sort avec le meilleur score (le problème devait être que les 3 variables en même temps s'annulaient : 11 joueurs contre 11) mais avec un 0.52 dégueu.

Comment prendre en compte la formation de l'équipe adverse ?
J'ai besoin d'un élément traduisant la stratégie sur le terrain. La possession en est un mais parfois celle ci s'explique surtout parce que les joueurs d'une équipe sont simplement techniquement beaucoup plus forts que leur adversaires et ont le ballon tout le temps.

De plus, j'imagine qu'il existe des situations où des coachs arrivent à empiéter sur la technique de leur adversaire même si celui-ci est meilleur, juste avec un ajustement tactique entraînant une modification de la formation.

La formation doit également me permettre de simuler des changements techniques liés à l'absence d'un cadre ou d'un joueur clé. La modification d'une formation en est la preuve puisqu'elle découle forcément d'un ajustement (soit face à cet adversaire, soit suite à une absence d'un joueur).

Après, chaque formation est unique et dépend de l'équipe qui l'a réalise .
J'imagine que le 4-3-3 du Milan n'aura pas le même impact que celui de la Roma sur un 4-4-2 de l'Inter. Je ne souhaite pas faire un modèle par équipe pour plusieurs raisons :
- Manque de données
- Déjà qu'en bossant sur 3 années j'ai des divergences de coach, d'effectifs etc alors bosser sur les seuls matchs d'une seule année par équipe et en pondre un modèle me semble risqué et peu prometteur.
- Eviter l'overfitting comme sur mes modèle NBA.

La variable opp_Formation pourrait être sympa mais le problème est le même, chaque formation appartenant à une équipe n'aura pas le même impact sur son adversaire. Peut-être que l'Inter ne perds jamais contre un 4-2-3-1 alors que la Forientina perd tout le temps contre ce type de formation (== renvoi encore à l'idée d'un modèle pas équipe qui n'est pas une solution viable).

On va quand même tester l'opp_formation en variable dummy.

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1197
Model:                          Logit   Df Residuals:                     1159
Method:                           MLE   Df Model:                           37
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2788
Time:                        21:23:14   Log-Likelihood:                -568.54
converged:                      False   LL-Null:                       -788.29
Covariance Type:            nonrobust   LLR p-value:                 2.544e-70
===============================================================================================
                                  coef    std err          z      P>|z|      [0.025      0.975]
-----------------------------------------------------------------------------------------------
Intercept                      -1.7675      7.854     -0.225      0.822     -17.162      13.627
C(Mois)[T.2]                    0.1036      0.333      0.311      0.755      -0.548       0.755
C(Mois)[T.3]                    0.3940      0.355      1.108      0.268      -0.303       1.091
C(Mois)[T.4]                    0.1866      0.308      0.606      0.544      -0.417       0.790
C(Mois)[T.5]                   -0.1715      0.326     -0.526      0.599      -0.811       0.468
C(Mois)[T.8]                   -0.1285      0.388     -0.331      0.741      -0.889       0.632
C(Mois)[T.9]                    0.3894      0.317      1.229      0.219      -0.232       1.011
C(Mois)[T.10]                   0.4320      0.297      1.454      0.146      -0.150       1.014
C(Mois)[T.11]                   0.4289      0.313      1.371      0.170      -0.184       1.042
C(Mois)[T.12]                  -0.1108      0.317     -0.350      0.726      -0.731       0.510
C(opp_Formation)[T.3-4-1-2]    -0.5469      0.662     -0.826      0.409      -1.845       0.751
C(opp_Formation)[T.3-4-3]      -0.9044      0.635     -1.425      0.154      -2.148       0.339
C(opp_Formation)[T.3-5-1-1]    -0.7012      0.848     -0.827      0.408      -2.363       0.961
C(opp_Formation)[T.3-5-2]      -0.7029      0.601     -1.171      0.242      -1.880       0.474
C(opp_Formation)[T.4-1-3-2]    14.2217    615.361      0.023      0.982   -1191.864    1220.307
C(opp_Formation)[T.4-1-4-1]    -0.9311      0.812     -1.147      0.252      -2.523       0.661
C(opp_Formation)[T.4-2-3-1]    -0.8688      0.634     -1.371      0.170      -2.111       0.373
C(opp_Formation)[T.4-3-1-2]    -0.8017      0.658     -1.218      0.223      -2.091       0.488
C(opp_Formation)[T.4-3-2-1]    -0.7027      0.776     -0.905      0.365      -2.224       0.819
C(opp_Formation)[T.4-3-3]      -0.7299      0.626     -1.166      0.244      -1.957       0.497
C(opp_Formation)[T.4-4-1-1]    -0.3570      0.853     -0.419      0.675      -2.028       1.314
C(opp_Formation)[T.4-4-2]      -0.4342      0.644     -0.674      0.500      -1.697       0.829
C(opp_Formation)[T.4-5-1]       8.8054   1011.736      0.009      0.993   -1974.161    1991.772
C(opp_Formation)[T.5-3-2]       0.4376      0.993      0.441      0.659      -1.508       2.383
C(opp_Formation)[T.5-4-1]       0.3103      1.338      0.232      0.817      -2.311       2.932
diff_def                        0.0197      0.154      0.128      0.899      -0.283       0.322
home                            0.4180      0.151      2.761      0.006       0.121       0.715
np.log(age)                     2.9480      2.069      1.425      0.154      -1.108       7.004
np.log(Poss)                   -2.4542      0.552     -4.449      0.000      -3.535      -1.373
SoT                             0.4693      0.047      9.969      0.000       0.377       0.562
np.log(Dist)                   -0.6390      0.476     -1.341      0.180      -1.573       0.295
np.log(Cmp)                     0.4676      1.209      0.387      0.699      -1.901       2.837
np.log(Int)                     0.1927      0.167      1.152      0.250      -0.135       0.521
diff_value                      0.0043      0.000     10.261      0.000       0.004       0.005
Sh                             -0.0935      0.021     -4.395      0.000      -0.135      -0.052
PK                              1.1046      0.193      5.714      0.000       0.726       1.484
CrdY                           -0.0358      0.059     -0.612      0.540      -0.150       0.079
CrdR                           -0.6192      0.244     -2.533      0.011      -1.098      -0.140
===============================================================================================
"""

R² toujours pas dingue
Octobre Novembre as usual (travailler en saison ? ?)
3-4-3, 4-2-3-1 avec les meilleurs scores ==> Vérifier qui joue en 3-4-3 c'est peut-être simplement le Milan ou la Juve et du coup ils influencent à fond les matchs et ils sont les seuls à jouer dans ces formations.

On va commencer à réfléchir à un modèle plus simple avec moins de variable mais je dois encore tester la variable Att.

Les équipes en 3-4-3
Torino         45
Atalanta       41
Roma           39
Bologna        17
Venezia         5
Cagliari        3
Napoli          3
Sassuolo        2
Spezia          2
Udinese         2
Fiorentina      2
Salernitana     1

les équipe en 4-2-3-1:
Milan          74
Napoli         50
Sassuolo       46
Bologna        33
Spezia         15
Roma           14
Genoa          13
Cagliari        7
Juventus        7
Fiorentina      5
Salernitana     4
Sampdoria       3
Atalanta        3
Venezia         1

En vrai il y en a beaucoup avec des niveaux très différents c'est plutôt rassurant

Modèle avec Att :

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1197
Model:                          Logit   Df Residuals:                     1158
Method:                           MLE   Df Model:                           38
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2788
Time:                        21:32:04   Log-Likelihood:                -568.53
converged:                      False   LL-Null:                       -788.29
Covariance Type:            nonrobust   LLR p-value:                 8.796e-70
===============================================================================================
                                  coef    std err          z      P>|z|      [0.025      0.975]
-----------------------------------------------------------------------------------------------
Intercept                      -2.0453      8.210     -0.249      0.803     -18.136      14.045
C(Mois)[T.2]                    0.1028      0.333      0.309      0.757      -0.549       0.755
C(Mois)[T.3]                    0.3947      0.356      1.110      0.267      -0.302       1.092
C(Mois)[T.4]                    0.1824      0.310      0.589      0.556      -0.425       0.790
C(Mois)[T.5]                   -0.1760      0.329     -0.536      0.592      -0.820       0.468
C(Mois)[T.8]                   -0.1341      0.391     -0.343      0.732      -0.901       0.633
C(Mois)[T.9]                    0.3858      0.318      1.212      0.226      -0.238       1.010
C(Mois)[T.10]                   0.4281      0.299      1.432      0.152      -0.158       1.014
C(Mois)[T.11]                   0.4298      0.313      1.374      0.169      -0.183       1.043
C(Mois)[T.12]                  -0.1102      0.317     -0.348      0.728      -0.731       0.510
C(opp_Formation)[T.3-4-1-2]    -0.5433      0.663     -0.819      0.413      -1.843       0.756
C(opp_Formation)[T.3-4-3]      -0.9020      0.635     -1.421      0.155      -2.146       0.342
C(opp_Formation)[T.3-5-1-1]    -0.6997      0.848     -0.825      0.409      -2.362       0.962
C(opp_Formation)[T.3-5-2]      -0.7017      0.601     -1.168      0.243      -1.879       0.475
C(opp_Formation)[T.4-1-3-2]    10.4920     94.940      0.111      0.912    -175.587     196.571
C(opp_Formation)[T.4-1-4-1]    -0.9281      0.813     -1.142      0.253      -2.521       0.665
C(opp_Formation)[T.4-2-3-1]    -0.8668      0.634     -1.367      0.172      -2.109       0.376
C(opp_Formation)[T.4-3-1-2]    -0.8040      0.658     -1.221      0.222      -2.094       0.486
C(opp_Formation)[T.4-3-2-1]    -0.7001      0.777     -0.902      0.367      -2.222       0.822
C(opp_Formation)[T.4-3-3]      -0.7275      0.626     -1.162      0.245      -1.955       0.500
C(opp_Formation)[T.4-4-1-1]    -0.3496      0.855     -0.409      0.683      -2.025       1.326
C(opp_Formation)[T.4-4-2]      -0.4302      0.645     -0.667      0.505      -1.695       0.834
C(opp_Formation)[T.4-5-1]       8.0444    682.083      0.012      0.991   -1328.814    1344.903
C(opp_Formation)[T.5-3-2]       0.4417      0.993      0.445      0.657      -1.505       2.389
C(opp_Formation)[T.5-4-1]       0.3204      1.340      0.239      0.811      -2.307       2.948
diff_def                        0.0195      0.154      0.126      0.900      -0.283       0.322
home                            0.4183      0.151      2.762      0.006       0.121       0.715
np.log(age)                     2.9964      2.111      1.419      0.156      -1.141       7.134
np.log(Poss)                   -2.3585      0.988     -2.387      0.017      -4.295      -0.422
SoT                             0.4693      0.047      9.970      0.000       0.377       0.562
np.log(Dist)                   -0.6393      0.477     -1.341      0.180      -1.573       0.295
np.log(Cmp)                     0.5796      1.544      0.375      0.707      -2.446       3.606
np.log(Int)                     0.1961      0.170      1.154      0.248      -0.137       0.529
diff_value                      0.0043      0.000     10.255      0.000       0.004       0.005
Sh                             -0.0936      0.021     -4.395      0.000      -0.135      -0.052
PK                              1.1035      0.194      5.701      0.000       0.724       1.483
CrdY                           -0.0370      0.059     -0.623      0.533      -0.154       0.079
CrdR                           -0.6203      0.245     -2.536      0.011      -1.100      -0.141
np.log(Att)                    -0.1201      1.028     -0.117      0.907      -2.135       1.895
===============================================================================================
"""

Change rien au R² et p-value éclatée au sol, on oublie ça!

Je vais créer des regroupement de formation pour qu'elles aient un peu plus la même tête avec 3 valeurs. Ca fausse carrément l'info par contre ça m'évitera les 4-4-1-1 qui doivent être relativement rares et qui du coup ont une p-value pourrie. Le vrai problème se pose au niveau des 4-2-3-1 et 4-3-2-1 le second étant défensif à fond contrairement au premier == donc l'info sur la stratégie est biaisée (pour pas dire autre chose).

les formations adverses avec le nombre d'apparition:
4-2-3-1    264
3-5-2      240
4-3-3      205
3-4-3      154
4-4-2       92
4-3-1-2     63
3-4-1-2     62
4-3-2-1     26
4-1-4-1     20
3-5-1-1     20
3-1-4-2     17
4-4-1-1     15
5-3-2       10
5-4-1        4
4-1-3-2      4
4-5-1        1

Soit je garde les plus importantes (>50 apparitions) soit je regroupe avec finalement très peu de risque car le premier regroupement problématique est le passage du 3-4-1-2 dans le 3-5-2 au dessus.

Go regrouper !
Toutefois, cela ne me permets pas de constater l'effet d'un 4-3-3 sur un 4-4-2 et celui du même 4-3-3 sur un 3-5-2 par exemple.
Une fois les regroupements fait, je pourrai peut-être faire de même avec les formations des équipes étudiés et créer des couple de formation en variable quali.


Avec les nouvelles formations adversaire :

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1217
Model:                          Logit   Df Residuals:                     1188
Method:                           MLE   Df Model:                           28
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2761
Time:                        21:46:52   Log-Likelihood:                -580.78
converged:                      False   LL-Null:                       -802.33
Covariance Type:            nonrobust   LLR p-value:                 3.221e-76
===================================================================================================
                                      coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------
Intercept                           0.2011      6.809      0.030      0.976     -13.144      13.546
C(Mois)[T.2]                        0.0378      0.325      0.116      0.908      -0.600       0.676
C(Mois)[T.3]                        0.3150      0.346      0.911      0.362      -0.363       0.993
C(Mois)[T.4]                        0.1798      0.300      0.598      0.550      -0.409       0.769
C(Mois)[T.5]                       -0.2208      0.321     -0.688      0.491      -0.850       0.408
C(Mois)[T.8]                       -0.2040      0.377     -0.541      0.589      -0.943       0.535
C(Mois)[T.9]                        0.3264      0.307      1.063      0.288      -0.275       0.928
C(Mois)[T.10]                       0.3518      0.290      1.213      0.225      -0.217       0.920
C(Mois)[T.11]                       0.3687      0.307      1.199      0.230      -0.234       0.971
C(Mois)[T.12]                      -0.2279      0.312     -0.731      0.465      -0.839       0.383
C(opp_Formation)[T.3-5-2]           0.3131      0.255      1.229      0.219      -0.186       0.813
C(opp_Formation)[T.3-6-1]           0.2678      0.623      0.430      0.667      -0.952       1.488
C(opp_Formation)[T.3-<NA>-<NA>]    17.9380   1.74e+04      0.001      0.999    -3.4e+04     3.4e+04
C(opp_Formation)[T.4-3-3]           0.2003      0.276      0.725      0.469      -0.341       0.742
C(opp_Formation)[T.4-4-2]           0.4259      0.295      1.446      0.148      -0.152       1.003
C(opp_Formation)[T.4-5-1]           0.1402      0.257      0.545      0.586      -0.364       0.645
C(opp_Formation)[T.4-<NA>-<NA>]     1.5265      0.887      1.720      0.085      -0.213       3.266
C(opp_Formation)[T.5-3-2]           1.3889      0.825      1.683      0.092      -0.228       3.006
C(opp_Formation)[T.5-4-1]           1.2593      1.224      1.029      0.304      -1.140       3.659
home                                0.4347      0.149      2.922      0.003       0.143       0.726
np.log(age)                         2.5032      2.019      1.240      0.215      -1.454       6.460
np.log(Poss)                       -2.3915      0.460     -5.198      0.000      -3.293      -1.490
SoT                                 0.4734      0.046     10.255      0.000       0.383       0.564
np.log(Dist)                       -0.5104      0.464     -1.100      0.272      -1.420       0.399
np.log(Int)                         0.1877      0.163      1.154      0.248      -0.131       0.506
diff_value                          0.0045      0.000     10.861      0.000       0.004       0.005
Sh                                 -0.0980      0.021     -4.730      0.000      -0.139      -0.057
PK                                  1.0656      0.190      5.598      0.000       0.692       1.439
CrdR                               -0.6979      0.239     -2.920      0.003      -1.166      -0.230
===================================================================================================
"""

R² bouge pas
Là c'est tout l'automne qui semble bizarre. Je vais faire 2 saisons (début de saison et reste de l'année).
3-6-1 ? Merci l'erreur
3-5-2, 4-4-2, 4-na-na (pf...) , 5-3-2 sont pas mal. Je pense virer les formations qui sortent pas souvent ou celles qui comportent des erreurs ùais y a un début de quelque chose.
Tester age, Dist et Int sans log maintenant peut-être.

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1217
Model:                          Logit   Df Residuals:                     1188
Method:                           MLE   Df Model:                           28
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2767
Time:                        21:51:37   Log-Likelihood:                -580.36
converged:                      False   LL-Null:                       -802.33
Covariance Type:            nonrobust   LLR p-value:                 2.167e-76
===================================================================================================
                                      coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------
Intercept                           4.9593      2.682      1.849      0.064      -0.298      10.216
C(Mois)[T.2]                        0.0469      0.326      0.144      0.886      -0.592       0.686
C(Mois)[T.3]                        0.3184      0.346      0.921      0.357      -0.359       0.996
C(Mois)[T.4]                        0.1861      0.301      0.619      0.536      -0.403       0.776
C(Mois)[T.5]                       -0.2121      0.321     -0.660      0.509      -0.842       0.417
C(Mois)[T.8]                       -0.1928      0.378     -0.511      0.610      -0.933       0.547
C(Mois)[T.9]                        0.3353      0.307      1.091      0.275      -0.267       0.938
C(Mois)[T.10]                       0.3540      0.290      1.220      0.222      -0.215       0.923
C(Mois)[T.11]                       0.3684      0.308      1.198      0.231      -0.234       0.971
C(Mois)[T.12]                      -0.2294      0.312     -0.735      0.462      -0.841       0.382
C(opp_Formation)[T.3-5-2]           0.3141      0.255      1.233      0.218      -0.185       0.813
C(opp_Formation)[T.3-6-1]           0.2652      0.624      0.425      0.671      -0.958       1.488
C(opp_Formation)[T.3-<NA>-<NA>]    17.8441   1.73e+04      0.001      0.999    -3.4e+04     3.4e+04
C(opp_Formation)[T.4-3-3]           0.2017      0.276      0.730      0.465      -0.340       0.743
C(opp_Formation)[T.4-4-2]           0.4294      0.295      1.458      0.145      -0.148       1.007
C(opp_Formation)[T.4-5-1]           0.1391      0.257      0.541      0.589      -0.365       0.643
C(opp_Formation)[T.4-<NA>-<NA>]     1.5208      0.888      1.712      0.087      -0.220       3.262
C(opp_Formation)[T.5-3-2]           1.4070      0.824      1.707      0.088      -0.208       3.023
C(opp_Formation)[T.5-4-1]           1.2761      1.226      1.041      0.298      -1.126       3.678
home                                0.4354      0.149      2.924      0.003       0.144       0.727
age                                 0.1027      0.080      1.284      0.199      -0.054       0.259
np.log(Poss)                       -2.3849      0.460     -5.180      0.000      -3.287      -1.483
SoT                                 0.4736      0.046     10.244      0.000       0.383       0.564
Dist                               -0.0327      0.027     -1.232      0.218      -0.085       0.019
Int                                 0.0236      0.018      1.335      0.182      -0.011       0.058
diff_value                          0.0045      0.000     10.819      0.000       0.004       0.005
Sh                                 -0.0984      0.021     -4.753      0.000      -0.139      -0.058
PK                                  1.0770      0.191      5.637      0.000       0.702       1.451
CrdR                               -0.6964      0.239     -2.912      0.004      -1.165      -0.228
===================================================================================================
"""

C'est mieux!

Test avec les couples de formations. Je veux filtrer les moins courants pour pas avoir 70 lignes de couples de formations.
Ca donne : 

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                  959
Model:                          Logit   Df Residuals:                      923
Method:                           MLE   Df Model:                           35
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2734
Time:                        21:57:01   Log-Likelihood:                -458.85
converged:                       True   LL-Null:                       -631.50
Covariance Type:            nonrobust   LLR p-value:                 1.107e-52
=====================================================================================================
                                        coef    std err          z      P>|z|      [0.025      0.975]
-----------------------------------------------------------------------------------------------------
Intercept                             5.6729      3.126      1.814      0.070      -0.455      11.801
C(Mois)[T.2]                         -0.0943      0.358     -0.264      0.792      -0.795       0.606
C(Mois)[T.3]                          0.4268      0.371      1.150      0.250      -0.301       1.154
C(Mois)[T.4]                          0.1147      0.332      0.345      0.730      -0.536       0.765
C(Mois)[T.5]                         -0.1329      0.357     -0.372      0.710      -0.834       0.568
C(Mois)[T.8]                         -0.2315      0.443     -0.523      0.601      -1.099       0.636
C(Mois)[T.9]                          0.5711      0.342      1.669      0.095      -0.100       1.242
C(Mois)[T.10]                         0.4282      0.333      1.288      0.198      -0.224       1.080
C(Mois)[T.11]                         0.2468      0.369      0.669      0.504      -0.476       0.970
C(Mois)[T.12]                        -0.0939      0.350     -0.268      0.788      -0.780       0.592
C(couple_Formation)[T.3-4-33-5-2]     0.1168      0.587      0.199      0.842      -1.034       1.268
C(couple_Formation)[T.3-4-34-5-1]     0.1830      0.635      0.288      0.773      -1.061       1.427
C(couple_Formation)[T.3-5-23-4-3]    -0.2643      0.611     -0.433      0.665      -1.461       0.933
C(couple_Formation)[T.3-5-23-5-2]    -0.1870      0.536     -0.349      0.727      -1.238       0.864
C(couple_Formation)[T.3-5-24-3-3]    -0.1740      0.564     -0.308      0.758      -1.280       0.932
C(couple_Formation)[T.3-5-24-4-2]    -0.2201      0.610     -0.361      0.718      -1.416       0.976
C(couple_Formation)[T.3-5-24-5-1]    -0.0235      0.549     -0.043      0.966      -1.100       1.053
C(couple_Formation)[T.4-3-33-5-2]     0.2990      0.549      0.545      0.586      -0.777       1.375
C(couple_Formation)[T.4-3-34-5-1]     0.2098      0.562      0.373      0.709      -0.892       1.312
C(couple_Formation)[T.4-4-23-5-2]    -0.4171      0.612     -0.682      0.495      -1.616       0.782
C(couple_Formation)[T.4-4-24-5-1]    -0.1751      0.595     -0.294      0.769      -1.342       0.991
C(couple_Formation)[T.4-5-13-4-3]    -0.1936      0.629     -0.308      0.758      -1.426       1.039
C(couple_Formation)[T.4-5-13-5-2]     0.3760      0.534      0.704      0.482      -0.671       1.423
C(couple_Formation)[T.4-5-14-3-3]    -0.1180      0.559     -0.211      0.833      -1.213       0.977
C(couple_Formation)[T.4-5-14-4-2]     0.4612      0.568      0.812      0.417      -0.652       1.574
C(couple_Formation)[T.4-5-14-5-1]    -0.4415      0.536     -0.823      0.410      -1.493       0.609
home                                  0.5459      0.168      3.245      0.001       0.216       0.876
age                                   0.1146      0.095      1.204      0.229      -0.072       0.301
np.log(Poss)                         -2.6508      0.524     -5.057      0.000      -3.678      -1.623
SoT                                   0.4799      0.052      9.247      0.000       0.378       0.582
Dist                                 -0.0271      0.031     -0.872      0.383      -0.088       0.034
Int                                   0.0362      0.020      1.787      0.074      -0.004       0.076
diff_value                            0.0045      0.000      9.590      0.000       0.004       0.005
Sh                                   -0.1015      0.023     -4.368      0.000      -0.147      -0.056
PK                                    0.8983      0.215      4.170      0.000       0.476       1.321
CrdR                                 -0.6687      0.275     -2.434      0.015      -1.207      -0.130
=====================================================================================================
"""

R² bouge toujours pas
Aucun couple de Formation ne semble significatif == On va rester sur les formations des adversaires je crois. cette dernière variable peut être plus significative si j'étudie le nombre de but plutôt que la victoire.
Dans le machine learning je pourrai tester les réseaux de neurones pour expliquer le résultat du match (W, D ou L) 3 valeurs au lieu de 2, c'est plus chiant pour les régressions standards.

Du coup dernier modèle, le plus significatif je pense avec le moins de variables possible et avec les saisons : 

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1217
Model:                          Logit   Df Residuals:                     1196
Method:                           MLE   Df Model:                           20
Date:                Tue, 17 Jan 2023   Pseudo R-squ.:                  0.2751
Time:                        22:13:09   Log-Likelihood:                -581.60
converged:                      False   LL-Null:                       -802.33
Covariance Type:            nonrobust   LLR p-value:                 4.910e-81
===================================================================================================
                                      coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------
Intercept                          -1.5311      2.117     -0.723      0.470      -5.681       2.619
C(saison)[T.reste]                 -0.3525      0.154     -2.284      0.022      -0.655      -0.050
C(opp_Formation)[T.3-5-2]           0.3465      0.254      1.366      0.172      -0.151       0.844
C(opp_Formation)[T.3-6-1]           0.2009      0.619      0.325      0.746      -1.012       1.414
C(opp_Formation)[T.3-<NA>-<NA>]    18.3521   1.74e+04      0.001      0.999    -3.4e+04    3.41e+04
C(opp_Formation)[T.4-3-3]           0.2102      0.275      0.763      0.445      -0.330       0.750
C(opp_Formation)[T.4-4-2]           0.4447      0.294      1.513      0.130      -0.131       1.021
C(opp_Formation)[T.4-5-1]           0.1670      0.255      0.654      0.513      -0.333       0.667
C(opp_Formation)[T.4-<NA>-<NA>]     1.5177      0.885      1.715      0.086      -0.217       3.252
C(opp_Formation)[T.5-3-2]           1.3498      0.809      1.668      0.095      -0.237       2.936
C(opp_Formation)[T.5-4-1]           1.4264      1.224      1.165      0.244      -0.973       3.826
home                                0.4403      0.149      2.965      0.003       0.149       0.731
age                                 0.1073      0.080      1.346      0.178      -0.049       0.264
Poss                               -0.0516      0.010     -5.262      0.000      -0.071      -0.032
SoT                                 0.4660      0.046     10.179      0.000       0.376       0.556
Dist                               -0.0332      0.027     -1.250      0.211      -0.085       0.019
Int                                 0.0232      0.018      1.320      0.187      -0.011       0.058
diff_value                          0.0045      0.000     10.863      0.000       0.004       0.005
Sh                                 -0.0953      0.020     -4.653      0.000      -0.135      -0.055
PK                                  1.0827      0.190      5.713      0.000       0.711       1.454
CrdR                               -0.7028      0.238     -2.949      0.003      -1.170      -0.236
===================================================================================================
"""

R² rien à dire ça bouge pas
Cool le reste de l'année devient significatif. Du coup, il y a moins de chances de victoires le reste de l'année qu'en automne ~ PLus de matchs nuls ?

A faire : Tester ce modèle avec les éléments que j'avais utilisé pour le modèle sur le Turf (graph etc...) avant de partir faire du machine learning.
BTW le log likelihood est à chier mais bon ... 

Je peux aussi recherche pourquoi j'avais fait le produit de deux variables dans le modèle Turf. ça pourrait aider à rendre un truc plus significatif peut-être. ==> c'est utile pour les variables qui sont liées entre elles . Par exemple : l'age et le sexe du cheval dans e turf. Le femelle ne subissent pas le même effet de l'age que les mâles.

Ici on pourrait utiliser ça pour les équipes et les formations des opposants ==> risque de diminuer le nombre d'observation mais pourquoi pas.
D'après la matrice de corrélation on peut lier :
home et Sh == 0.18
SoT et poss == 0.27
SoT et diff value == 0.35
SoT et Sh mais va falloir que j'en choisisse qu'un (Sh plus précis et moins d'erreur mais coeff beaucoup plus faible...)
Dist et PK == 0.14
Dist et diff_value == -0.19
Dist et SoT == -0.19
Int et poss == -0.19
Diff_value (poss, sot, Sh : 0.47 ; 0.37 ; 0.36)
Sh home et Sh Poss (0.18 et 0.46)

Du coup pour libérer Sh je croiserais bien SoT et Dist 
Diff value a pas mal de corrélation avec les variables du modèle, est-ce que je devrais la croiser aussi (à tester)
J'ajoute aussi un croisement team*opp_Formation

Pas pu croiser team et opp_Formation (pas assez d'observations du coup j'obtiens une erreur de matrice). Pour le reste voilà ce qu'on a :

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1217
Model:                          Logit   Df Residuals:                     1194
Method:                           MLE   Df Model:                           22
Date:                Wed, 18 Jan 2023   Pseudo R-squ.:                  0.2767
Time:                        20:56:46   Log-Likelihood:                -580.34
converged:                      False   LL-Null:                       -802.33
Covariance Type:            nonrobust   LLR p-value:                 3.287e-80
===================================================================================================
                                      coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------
Intercept                          -2.3886      2.265     -1.054      0.292      -6.829       2.051
C(saison)[T.reste]                 -0.3621      0.155     -2.337      0.019      -0.666      -0.058
C(opp_Formation)[T.3-5-2]           0.3523      0.253      1.390      0.164      -0.144       0.849
C(opp_Formation)[T.3-6-1]           0.2012      0.622      0.324      0.746      -1.018       1.420
C(opp_Formation)[T.3-<NA>-<NA>]    18.2004   1.74e+04      0.001      0.999    -3.4e+04     3.4e+04
C(opp_Formation)[T.4-3-3]           0.1948      0.275      0.708      0.479      -0.344       0.734
C(opp_Formation)[T.4-4-2]           0.4353      0.294      1.480      0.139      -0.141       1.012
C(opp_Formation)[T.4-5-1]           0.1630      0.255      0.640      0.522      -0.336       0.662
C(opp_Formation)[T.4-<NA>-<NA>]     1.5374      0.885      1.738      0.082      -0.197       3.271
C(opp_Formation)[T.5-3-2]           1.3036      0.808      1.613      0.107      -0.280       2.887
C(opp_Formation)[T.5-4-1]           1.2912      1.227      1.053      0.292      -1.113       3.695
home                                0.4438      0.149      2.982      0.003       0.152       0.736
age                                 0.1057      0.080      1.324      0.186      -0.051       0.262
Poss                               -0.0524      0.010     -5.297      0.000      -0.072      -0.033
diff_value                          0.0028      0.002      1.523      0.128      -0.001       0.006
Poss:diff_value                  3.457e-05   3.59e-05      0.963      0.336   -3.58e-05       0.000
SoT                                 0.7269      0.214      3.396      0.001       0.307       1.146
Dist                                0.0183      0.049      0.373      0.709      -0.078       0.115
SoT:Dist                           -0.0147      0.012     -1.248      0.212      -0.038       0.008
Int                                 0.0238      0.018      1.351      0.177      -0.011       0.058
Sh                                 -0.0974      0.021     -4.716      0.000      -0.138      -0.057
PK                                  1.0730      0.190      5.655      0.000       0.701       1.445
CrdR                               -0.7033      0.238     -2.955      0.003      -1.170      -0.237
===================================================================================================
"""

R² change pas
Poss*diff_value pas significatif
Tirs cadrés et distance améliore la significativité de la distance mais nul pour SoT

avec le log de la distance sur la possession ?

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1217
Model:                          Logit   Df Residuals:                     1178
Method:                           MLE   Df Model:                           38
Date:                Wed, 18 Jan 2023   Pseudo R-squ.:                  0.2932
Time:                        21:00:56   Log-Likelihood:                -567.10
converged:                      False   LL-Null:                       -802.33
Covariance Type:            nonrobust   LLR p-value:                 5.732e-76
===================================================================================================
                                      coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------
Intercept                           0.2069   9.66e+06   2.14e-08      1.000   -1.89e+07    1.89e+07
C(team)[T.Bologna]                 -0.3652   3.15e+05  -1.16e-06      1.000   -6.18e+05    6.18e+05
C(team)[T.Cagliari]                -0.9535   1.97e+05  -4.84e-06      1.000   -3.86e+05    3.86e+05
C(team)[T.Empoli]                  -0.0725      0.494     -0.147      0.883      -1.040       0.895
C(team)[T.Fiorentina]              -0.2337   3.55e+05  -6.59e-07      1.000   -6.95e+05    6.95e+05
C(team)[T.Genoa]                   -1.2364   6.31e+05  -1.96e-06      1.000   -1.24e+06    1.24e+06
C(team)[T.Juventus]                -0.7922   1.97e+05  -4.02e-06      1.000   -3.86e+05    3.86e+05
C(team)[T.Lazio]                    0.0588   1.06e+06   5.53e-08      1.000   -2.09e+06    2.09e+06
C(team)[T.Milan]                   -0.0685   3.15e+05  -2.17e-07      1.000   -6.18e+05    6.18e+05
C(team)[T.Napoli]                   0.5851   3.15e+05   1.86e-06      1.000   -6.18e+05    6.18e+05
C(team)[T.Roma]                    -0.1814   2.76e+05  -6.58e-07      1.000   -5.41e+05    5.41e+05
C(team)[T.Salernitana]             -0.7230   5.52e+05  -1.31e-06      1.000   -1.08e+06    1.08e+06
C(team)[T.Sampdoria]               -0.5866    6.7e+05  -8.76e-07      1.000   -1.31e+06    1.31e+06
C(team)[T.Sassuolo]                -0.4433   1.97e+05  -2.25e-06      1.000   -3.86e+05    3.86e+05
C(team)[T.Spezia]                   0.0481   3.55e+05   1.36e-07      1.000   -6.95e+05    6.95e+05
C(team)[T.Torino]                  -0.6977   1.18e+05   -5.9e-06      1.000   -2.32e+05    2.32e+05
C(team)[T.Udinese]                 -0.4491   1.97e+05  -2.28e-06      1.000   -3.86e+05    3.86e+05
C(team)[T.Venezia]                 -0.7210   7.88e+04  -9.15e-06      1.000   -1.54e+05    1.54e+05
C(saison)[T.reste]                 -0.3684      0.157     -2.344      0.019      -0.677      -0.060
C(opp_Formation)[T.3-5-2]           0.3678      0.262      1.405      0.160      -0.145       0.881
C(opp_Formation)[T.3-6-1]           0.3092      0.637      0.485      0.628      -0.940       1.558
C(opp_Formation)[T.3-<NA>-<NA>]    18.1789   1.74e+04      0.001      0.999    -3.4e+04     3.4e+04
C(opp_Formation)[T.4-3-3]           0.1739      0.284      0.614      0.540      -0.382       0.730
C(opp_Formation)[T.4-4-2]           0.4724      0.300      1.574      0.116      -0.116       1.061
C(opp_Formation)[T.4-5-1]           0.1600      0.260      0.615      0.539      -0.350       0.670
C(opp_Formation)[T.4-<NA>-<NA>]     1.8035      0.941      1.917      0.055      -0.041       3.648
C(opp_Formation)[T.5-3-2]           1.6529      0.826      2.001      0.045       0.034       3.272
C(opp_Formation)[T.5-4-1]           1.5332      1.243      1.234      0.217      -0.903       3.969
home                                0.4767      0.152      3.141      0.002       0.179       0.774
age                                 0.1455   3.94e+05   3.69e-07      1.000   -7.72e+05    7.72e+05
Poss                               -0.0755      0.132     -0.573      0.566      -0.334       0.183
np.log(Dist)                       -0.8925      2.265     -0.394      0.694      -5.332       3.547
Poss:np.log(Dist)                   0.0052      0.046      0.113      0.910      -0.085       0.095
SoT                                 0.4568      0.047      9.705      0.000       0.365       0.549
diff_value                          0.0042      0.001      7.519      0.000       0.003       0.005
Int                                 0.0323      0.019      1.740      0.082      -0.004       0.069
Sh                                 -0.0959      0.021     -4.465      0.000      -0.138      -0.054
PK                                  1.0627      0.195      5.459      0.000       0.681       1.444
CrdR                               -0.7136      0.242     -2.952      0.003      -1.187      -0.240
===================================================================================================
"""
Aucune équipe n'est significative LOL
Log de la dist avec poss et l'ajout de l'équipe me flingue la significativité de l'age.
On oublie ça!

Modèle "final" avec uniquement les formation opposées qui sortent plus de 100 fois :

reg = smf.logit('victoire ~ home + age + Poss + Dist + SoT + diff_value + Int + C(saison) + Sh + PK + CrdR + C(opp_Formation)',
                  data=df_reg).fit()


<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1173
Model:                          Logit   Df Residuals:                     1157
Method:                           MLE   Df Model:                           15
Date:                Wed, 18 Jan 2023   Pseudo R-squ.:                  0.2696
Time:                        21:05:49   Log-Likelihood:                -560.16
converged:                       True   LL-Null:                       -766.87
Covariance Type:            nonrobust   LLR p-value:                 1.039e-78
=============================================================================================
                                coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------
Intercept                    -1.4130      2.146     -0.658      0.510      -5.619       2.793
C(saison)[T.reste]           -0.3605      0.156     -2.310      0.021      -0.666      -0.055
C(opp_Formation)[T.3-5-2]     0.3283      0.254      1.293      0.196      -0.169       0.826
C(opp_Formation)[T.4-3-3]     0.2102      0.276      0.762      0.446      -0.330       0.751
C(opp_Formation)[T.4-4-2]     0.4219      0.294      1.434      0.152      -0.155       0.999
C(opp_Formation)[T.4-5-1]     0.1617      0.256      0.633      0.527      -0.339       0.663
home                          0.4838      0.152      3.188      0.001       0.186       0.781
age                           0.0944      0.081      1.170      0.242      -0.064       0.252
Poss                         -0.0494      0.010     -4.976      0.000      -0.069      -0.030
Dist                         -0.0297      0.027     -1.095      0.273      -0.083       0.023
SoT                           0.4712      0.046     10.141      0.000       0.380       0.562
diff_value                    0.0045      0.000     10.748      0.000       0.004       0.005
Int                           0.0247      0.018      1.376      0.169      -0.010       0.060
Sh                           -0.0951      0.021     -4.557      0.000      -0.136      -0.054
PK                            1.0045      0.192      5.220      0.000       0.627       1.382
CrdR                         -0.7089      0.242     -2.931      0.003      -1.183      -0.235
=============================================================================================
"""
INFOS SUR LE MODELE

np.mean(df_reg["error"])
Out[29]: -6.341427335881116e-18
Super faible c'est cool ---------------------

np.std(df_reg["error"])
Out[30]: 0.3955620646424434
Pas mal élevé pas dingue ----------------

np.percentile(df_reg["pred"],2.5)
Out[34]: 0.02769251005225839

np.percentile(df_reg["pred"],75)
Out[35]: 0.565428359825682
75% des observations ont une valeur inférieure à 0.56
C'est pas 0.5 mais pas loin mais du coup c'est peut-être cool car en comptant les défaites et les matchs nuls, il n'y aurait rien d'étonnant à ce qu'il y ait 30 % seulement de victoire dans ma base :

sum(df_reg["victoire"])/len(df_reg)
Out[38]: 0.36061381074168797
Hey hey 36% de victoire seulement, c'est bon signe !!

Quelques tests graphique sur la nécessité de faire un log pour les variables numériques :
Voir le script python pour sortir les graphs

- Dist == aucun besoin, répartition presque normale à l'oeil
- age == pas mieux en log malheureusement (c'est ptetre pour ça que c'est pas giga significatif)
- Poss == Quelle belle distribution normale (j'ai pas mieux en log)
- SoT == Impossible car j'ai des 0 qui me donne -inf et foutent la merde
- diff_value == Carrément mieux sans log 
- Int == A l'air un peu mieux en log
- Sh == pas utile je pense 
- PK == Impossible car présence de 0 (comme SoT) mais seulement un max de 2 --> Tester en variable quali ?
- Idem pour CrdR

Test avec quali PK CrdR et home et log de int :

Il faut d'abord recoder les variables PK et CrdR pour n'avoir que 2 catégories à chaque fois (il y en a au moins un, il y en a pas)

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1173
Model:                          Logit   Df Residuals:                     1157
Method:                           MLE   Df Model:                           15
Date:                Wed, 18 Jan 2023   Pseudo R-squ.:                  0.2668
Time:                        21:36:54   Log-Likelihood:                -562.24
converged:                       True   LL-Null:                       -766.87
Covariance Type:            nonrobust   LLR p-value:                 7.809e-78
=============================================================================================
                                coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------
Intercept                    -1.4572      2.186     -0.667      0.505      -5.741       2.827
C(home)[T.1]                  0.4750      0.151      3.138      0.002       0.178       0.772
C(saison)[T.reste]           -0.3490      0.156     -2.239      0.025      -0.654      -0.044
C(Penalty)[T.1]               1.0350      0.215      4.822      0.000       0.614       1.456
C(Rouge)[T.1]                -0.8033      0.265     -3.036      0.002      -1.322      -0.285
C(opp_Formation)[T.3-5-2]     0.2728      0.252      1.083      0.279      -0.221       0.766
C(opp_Formation)[T.4-3-3]     0.1534      0.274      0.560      0.575      -0.383       0.690
C(opp_Formation)[T.4-4-2]     0.3823      0.292      1.309      0.191      -0.190       0.955
C(opp_Formation)[T.4-5-1]     0.1183      0.254      0.466      0.641      -0.380       0.616
age                           0.0890      0.080      1.106      0.269      -0.069       0.247
Poss                         -0.0491      0.010     -4.952      0.000      -0.069      -0.030
Dist                         -0.0273      0.027     -1.009      0.313      -0.080       0.026
SoT                           0.4653      0.046     10.070      0.000       0.375       0.556
diff_value                    0.0045      0.000     10.814      0.000       0.004       0.005
np.log(Int)                   0.2044      0.164      1.243      0.214      -0.118       0.527
Sh                           -0.0955      0.021     -4.578      0.000      -0.136      -0.055
=============================================================================================
"""

J'améliore le score du carton rouge mais baisse un peu l'effet début de saison, age, Dist et Int.

J'enlève le log de Int :

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1173
Model:                          Logit   Df Residuals:                     1157
Method:                           MLE   Df Model:                           15
Date:                Wed, 18 Jan 2023   Pseudo R-squ.:                  0.2669
Time:                        21:38:59   Log-Likelihood:                -562.18
converged:                       True   LL-Null:                       -766.87
Covariance Type:            nonrobust   LLR p-value:                 7.336e-78
=============================================================================================
                                coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------
Intercept                    -1.2215      2.140     -0.571      0.568      -5.416       2.973
C(home)[T.1]                  0.4765      0.151      3.147      0.002       0.180       0.773
C(saison)[T.reste]           -0.3480      0.156     -2.233      0.026      -0.653      -0.043
C(Penalty)[T.1]               1.0391      0.215      4.839      0.000       0.618       1.460
C(Rouge)[T.1]                -0.8011      0.265     -3.027      0.002      -1.320      -0.282
C(opp_Formation)[T.3-5-2]     0.2779      0.252      1.104      0.270      -0.215       0.771
C(opp_Formation)[T.4-3-3]     0.1596      0.274      0.583      0.560      -0.377       0.696
C(opp_Formation)[T.4-4-2]     0.3885      0.292      1.331      0.183      -0.184       0.961
C(opp_Formation)[T.4-5-1]     0.1234      0.254      0.486      0.627      -0.374       0.621
age                           0.0880      0.080      1.094      0.274      -0.070       0.246
Poss                         -0.0491      0.010     -4.953      0.000      -0.069      -0.030
Dist                         -0.0273      0.027     -1.009      0.313      -0.080       0.026
SoT                           0.4665      0.046     10.084      0.000       0.376       0.557
diff_value                    0.0045      0.000     10.793      0.000       0.004       0.005
Int                           0.0232      0.018      1.299      0.194      -0.012       0.058
Sh                           -0.0958      0.021     -4.592      0.000      -0.137      -0.055
=============================================================================================
"""

Constat :

j'améliore le log-likelihood mais je perds en significativité sur certaines variables.
J'améliore aussi la p-value mais cette version me pose un problème :

	Dans le cas des penaltys et des cartons rouges, le fait d'en prendre un dans le match a certes un effet sur le cours du matchs mais le fait d'en avoir 2 ou plus est quand même le signe que le match part u peu en la faveur/défaveur d'une équipe.
Un fait de jeu peu entraîner un rouge et le sur nombre de l'equipe adverse peu jouer sur le résultat final (dépendemment du poste du joueur exclu et du temps de jeu écoulé). Cependant, en prendre 2 ou 3 est quand même signe que l'équipe soit n'arrive pas à suivre l'adversaire et se frustre, soit que l'arbitre a une petite préférence. Et inversement pour le nombre de penaltys obtenus.
	Pour le coup, avoir plus d'un penalty ou plus d'un carton rouge est véritablement signe d'un déséquilibre dans le match et peut entraîner un changement radical du cours du jeu. 
Malheureusement, je n'ai pas assez d'observations pour les matchs avec 2 ou plus penaltys ou carton rouges et ces valeurs ne sont pas significatives :

C(PK)[T.1]                    0.9196      0.221      4.153      0.000       0.486       1.354
C(PK)[T.2]                    2.4439      0.712      3.430      0.001       1.047       3.840
C(PK)[T.3]                   16.6306   5864.846      0.003      0.998   -1.15e+04    1.15e+04
C(CrdR)[T.1]                 -0.7592      0.273     -2.780      0.005      -1.294      -0.224
C(CrdR)[T.2]                 -0.9926      0.960     -1.034      0.301      -2.874       0.888

La valeur des 2 penaltys et cool et significative et celle des 3 est folle mais non significative
Les deux rouges ne sont pas significatifs mais me donnent envie de les garder.
Je vire de la base les matchs avec 3 peno (j'en avais 1 seul) : 

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1172
Model:                          Logit   Df Residuals:                     1154
Method:                           MLE   Df Model:                           17
Date:                Wed, 18 Jan 2023   Pseudo R-squ.:                  0.2691
Time:                        21:49:38   Log-Likelihood:                -559.74
converged:                       True   LL-Null:                       -765.85
Covariance Type:            nonrobust   LLR p-value:                 5.134e-77
=============================================================================================
                                coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------
Intercept                    -1.4698      2.150     -0.684      0.494      -5.683       2.744
C(home)[T.1]                  0.4842      0.152      3.189      0.001       0.187       0.782
C(saison)[T.reste]           -0.3675      0.157     -2.348      0.019      -0.674      -0.061
C(PK)[T.1]                    0.9196      0.221      4.153      0.000       0.486       1.354
C(PK)[T.2]                    2.4439      0.712      3.430      0.001       1.047       3.840
C(CrdR)[T.1]                 -0.7592      0.273     -2.780      0.005      -1.294      -0.224
C(CrdR)[T.2]                 -0.9926      0.960     -1.034      0.301      -2.874       0.888
C(opp_Formation)[T.3-5-2]     0.3515      0.256      1.372      0.170      -0.151       0.854
C(opp_Formation)[T.4-3-3]     0.2330      0.278      0.837      0.403      -0.313       0.778
C(opp_Formation)[T.4-4-2]     0.4406      0.296      1.489      0.136      -0.139       1.020
C(opp_Formation)[T.4-5-1]     0.1837      0.258      0.713      0.476      -0.321       0.689
age                           0.0969      0.081      1.200      0.230      -0.061       0.255
Poss                         -0.0497      0.010     -4.995      0.000      -0.069      -0.030
Dist                         -0.0301      0.027     -1.108      0.268      -0.083       0.023
SoT                           0.4726      0.047     10.146      0.000       0.381       0.564
diff_value                    0.0045      0.000     10.747      0.000       0.004       0.005
Int                           0.0253      0.018      1.408      0.159      -0.010       0.061
Sh                           -0.0954      0.021     -4.569      0.000      -0.136      -0.054
=============================================================================================
"""

Ca me plait bien. C'est un bon milieu entre le premier modèle avec beaucoup de variables significative mais des valeurs du modèle améliorables et le second avec un meilleur LLH et une meilleur p-value.
 
Je refais les test stat du modèle :

np.mean(df_reg["error"])
Out[81]: -1.1805592529343869e-17 ==>> minuscule c'est cool

np.std(df_reg["error"])
Out[82]: 0.39552773198394914 ==>> Un peu toujours pareil

np.percentile(df_reg["pred"],2.5)
Out[83]: 0.027486871231418193

np.percentile(df_reg["pred"],70)
Out[84]: 0.4930309242363654

A retenir de ce premier modèle de régression avant de passer au machine learning ::

	- Il n'est pas possible via un modèle logit de prouver qu'une organisation d'équipe aura plus d'impact sur une Formation qu'une autre. C'est dommage, c'est la piste que je voulais explorer, peut-être que le machine learning me permettra d'obtenir quelque chose de ça.

	- La valeur de l'équipe au sens de TransferMarkt, reflète en général plutôt bien les résultats de l'équipe. En effet, posséder des joueurs plus chers (surtout en série A plus qu'en Premier league j'imagine) entraîne un meilleur niveau de jeu donc une possession du ballon plus simple, plus de frappes dont plus de tirs cadrés et ainsi de siute. La valeur des équipe a un effet sur la victoire (triste je trouve) mais réaliste. Cependant le coefficient de la différence de valeur de 2 équipes reste relativement faible. Dans la mesure où il s'agit de montant en centaines exprimées en millions d'€ pour les plus grandes écuries, on peut multiplier ce coefficient par 100 pour obtenir l'effet d'un écart de 100 millions.
Toutefois, il reste inférieur à 0.5. Ce qui signifie que techniquement avoir un effectif beaucoup plus cher aide à gagner mais n'assure en rien une victoire. Après, tout ça reste logique.

	- Je ne dispose pas d'assez d'observations par équipe pour introduire l'équipe comme une variable couplée à la formation adverse afin d'observer l'effet d'un 4-3-3 sur l'Inter par exemple...

	- Le fait de jouer à domicile entraîne 48 % de chances de plus de victoire (quid de Milan et de l'Inter lorsqu'ils se recontrent?)

	- Il existe un effet début de saison/automne que je dois encore approfondir. Durant cette période il semblerait que les chances de victoire soient plus élevée. Pour le moment, par pure logique je penses simplement qu'en début de saison les équipes sont au complet (pas de blessé) et reposées, elles veulent entrer en matière le mieux possible et s'arrachent peut-être plus pour aller chercher les 3 points afin d'asseoir leur leadership dans le championnat avant d'atteindre une vitesse de croisière le reste de la saison quitte à prendre un ou deux matchs nuls en plus pour préserver les stars (pour la LDC par exemple).

	- L'obtention de penaltys augmente de manière exponentielle les chances de victoire. Un seul penalty (à équipe égales) augmente de 91% les chance de victoire. 2 les augmente de plus de 200 % et 3 (comme vu tout à l'heure) de plus de 1 600% 

	- L'obtention de cartons rouges entraînent une chute des chances de victoire (75% pour 1 rouge et 99 % pour 2 à équipes équivalentes). L'effet est bien plus fort que ce que j'aurais imaginé avant de créer le modèle (surtout pour 1). Je pensais qu'il arrivait souvent qu'une équipe gagne même en ayant pris un rouge parce que le coach organise bien le remplacement et joue plus la défense. L'étude des matchs nuls et défaites dans le cadre du machine learning m'aidera peut-être à y voir plus clair. 
 
	- Les deux seules formations pas trop dégueu en termes de significativité sont le 3-5-2 et le 4-4-2. Le 4-5-1 étant la référence du modèle, toutes les autres formations augmentent les chances de victoire (jusqu'à 44 % pour le 4-4-2). Le 4-5-1 étant souvent défensif, cela s'expliquerait ainsi. Tester avec un autre système référence serait intéliigent.

	- L'âge n'est pas très significatif mais ce qu'il indique est que plus un effectif est expérimenté, plus il a de chance de gagner. Bien sûr, il n'est pas difficile d'imaginer qu'une équipe de quadra en chierait face à une équipe de série A. Ce qu'il faut voir ici, c'est que lorsque l'effectif monté par les dirigeants et les directeurs sportifs sont un peu plus experimentés, ils sont plus peformants (sûrement plus chers aussi et donc cela se recroise avec la diff_value vue plus haut ==> entraîne plus de possession donc plus de frappes, donc plus de tirs cadrés et plus de buts etc...) BTW, le max est de 27.2 ans , c'est pas bien vieux... Mais cette variable traduit de la bonne conception d'un effectif je pense.

	- Etonnemment, le coeff de la possession est négatif. cela voudrait dire que plus une équipe a le ballon, moins elle peut gagner (à hauteur de -5 % si elle a 100% de possession). Je ne m'attendais pas à ça. Du coup, pourquoi pas mais qu'est ce qui explique cela? Est-ce qu'une trop forte possession entraîne plus de défene en face et donc moins de réussite --> moins de buts --> plus de matchs nuls (voir plus de défait si en plus l'adversaire profite d'un contre ou d'un penalty). En soit, l'équipe de France a prouvé en 2018 que ça tenait la route de laisser le ballon à l'adversaire. Est-ce que les coachs en Italie se sont tous mis à la page Deschamps ? Je vais continuer de matter des  matchs et me renseigner là dessus quand même car même si l'effet reste très léger il n'en est pas moins contre-intuitif (prends ça dans les dents Mourinho).

	- Le fait que le coefficient de la distance soit négatif est quant à lui bien plus logique. En effet, si l'équipe tire en moyenne de plus loin c'est qu'elle n'arrive pas à ce créer les bonnes opportunité. Le cas extrême c'est le houra-football dans lequel l'équipe frappe désespéremment à 45 mètres du cadre parce qu'au delà, elle se fait reprendre la balle. Cette variable semble également traduire de la domination d'une équipe sur l'autre. Tester la colinéarité avec les cartons rouges et/ou les pénaltys.

	- SoT est significatif et positif ==> Logique, plus l'équipe se procure de frappes cadrées, plus elle a de chance de marquer et donc de gagner le match. Rien à dire ici.

	- Effectuer plus d'interception augmente les chance de victoire : plutôt logique. Mais cet élément est à garder dans un coin de la tête si je veux bosser sur l'effet milieu def d'une équipe (je pense que le milieu défensif est peut-être l'élément le plus important d'un bon effectif et d'une équipe qui gagne. Un meilleur 6 entraîne plus de sérénité et de meilleurs résultats ==> C'est ce que j'aimerais prouver pour montrer que l'attaque c'est cool mais le milieu c'est plus important).

	- Enfin, le nombre de tir total est significatif mais négatif --> En gros prendre pleins de tirs n'assure pas du tout de marquer plus que l'adversaire, c'est le réalisme qui paye le plus #Deschamps encore. Cependant, il serait intéressant de coupler cette variable avec la distance (plutôt que les tirs cadrés comme je l'ai déjà fait). Dans la matrice de corrélation de la table, ces deux variables ont un coefficient de -0.1. En gros, si une équipe tir de plus loin, elle a automatiquement moins de frappes.

Pour poursuivre, j'aimerais donc bosser sur les effets des formations sur les équipes et je commence fortement à penser à un indicateur de domination dans le jeu regroupant le nombre de cartons rouges/jaunes de l'adversaire, la possession (même si on a vu que cette variable était contre-intuitive), la distance de tir et le nombre total de tirs. Ces deux dernières expriment les difficultés rencontrées par l'équipe à attaquer alors que les penaltys et les cartons, montrent plutôt les difficultés à défendre. 

A priori l'effet sur la possession viendrait du fait que seules quelques équipes jouent la possession mais que le Calcio est un football de contre. Je vérifie ça dans les datas :

205 victoire sur 551 équipes avec une possession de plus de 50 % ==> 37 %
Le top des équipes avec la possession et qui gagnent :
Napoli            40
Internazionale    31
Milan             29
Lazio             23
Juventus          22

En effet, le Napoli, l'Inter, Milan, la Lazio et la Juve ressortent (5 des 5 premiers de série A cette année). Ce sont plutôt les gros qui jouent la possession.

Autre question :: évolution des formations avec 3 défenseurs .

Pas d'évolution notable sur les 3 saisons du fichier. Cependant, je dois confirmer le fait que c'est un truc plutôt italien (catenacio) axé sur la défense. Je suis biaisé car pour moi les systèmes les plus communs seront plutôt des variantes du 4-4-2 ou du 4-3-3 mais toujours avec 4 défenseurs. Mais je peux me tromper. Pour en être sûr je devrais regarder dans d'autres championnats.
A priori c'est plutôt un style de jeu italien dans lequel les deux milieux latéraux passent en attaque sur les phases offensives et viennent renforcer la défense (défense à 5) lors des phases défensives == est-ce que c'est le catenacio ?
 

Ne serait-il pas possible de voir l'effet d'une formation sur la difficulté d'attaquer et de défendre d'une équipe == A CREUSER!

Voir également si je peux pas tester mon modèle sur les matchs non perdu pour voir la différence d'effet sur la victoire ou le match nul ou un truc du style (car je verrai pas les coeff en machine learning)

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               not_lose   No. Observations:                 1172
Model:                          Logit   Df Residuals:                     1154
Method:                           MLE   Df Model:                           17
Date:                Thu, 19 Jan 2023   Pseudo R-squ.:                  0.2193
Time:                        21:01:05   Log-Likelihood:                -607.06
converged:                      False   LL-Null:                       -777.61
Covariance Type:            nonrobust   LLR p-value:                 3.484e-62
=============================================================================================
                                coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------
Intercept                     2.0480      2.015      1.016      0.310      -1.902       5.998
C(home)[T.1]                  0.3698      0.144      2.563      0.010       0.087       0.653
C(saison)[T.reste]            0.2307      0.149      1.550      0.121      -0.061       0.522
C(PK)[T.1]                    0.9288      0.249      3.737      0.000       0.442       1.416
C(PK)[T.2]                   24.3161   5.08e+04      0.000      1.000   -9.95e+04    9.96e+04
C(CrdR)[T.1]                 -0.6737      0.224     -3.007      0.003      -1.113      -0.235
C(CrdR)[T.2]                  0.1299      0.826      0.157      0.875      -1.489       1.749
C(opp_Formation)[T.3-5-2]     0.3138      0.239      1.315      0.189      -0.154       0.782
C(opp_Formation)[T.4-3-3]    -0.1191      0.254     -0.468      0.639      -0.618       0.379
C(opp_Formation)[T.4-4-2]     0.2910      0.279      1.045      0.296      -0.255       0.837
C(opp_Formation)[T.4-5-1]     0.0491      0.235      0.209      0.834      -0.411       0.509
age                           0.0170      0.075      0.227      0.820      -0.130       0.164
Poss                         -0.0560      0.010     -5.799      0.000      -0.075      -0.037
Dist                         -0.0183      0.024     -0.764      0.445      -0.065       0.029
SoT                           0.3356      0.046      7.342      0.000       0.246       0.425
diff_value                    0.0044      0.000     10.847      0.000       0.004       0.005
Int                           0.0088      0.017      0.511      0.609      -0.025       0.043
Sh                           -0.0484      0.020     -2.367      0.018      -0.088      -0.008
=============================================================================================

le R² est pire
le LLH est pire 
et la p value aussi

Le double pénalty est complétement non significatif
presque p	areil pour le double rouge ==> Quelque part ces deux modifs sont logiques et confirment leur effet sur la défaite vu dans le modèle précédent.

L'age est encore moins significatif également

Sur les coeff significatifs, quelles peuvent être les différences avec le modèle basé sur les victoires :
	La possession a un effet encore plus négatif == Donc les équipe qui ont la possession ne font même pas de matchs nuls
	Les tirs cadrés baissent également (logique puisqu'on étudie aussi les matchs nuls dans ce modèle)
	La différence de valeur bouge peu mais vu qu'elle induit des montant élevés, ce n'est pas si anodin. Elle a ici un peu moins d'impact sur le résultat du match.



Teste avec une autre formation que le 3-4-3 en référence pour les coeffs.

Avec le 4-5-1 en référence :

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1172
Model:                          Logit   Df Residuals:                     1154
Method:                           MLE   Df Model:                           17
Date:                Fri, 20 Jan 2023   Pseudo R-squ.:                  0.2691
Time:                        20:15:15   Log-Likelihood:                -559.74
converged:                       True   LL-Null:                       -765.85
Covariance Type:            nonrobust   LLR p-value:                 5.134e-77
===========================================================================================================================
                                                              coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------------------------------
Intercept                                                  -1.2862      2.138     -0.602      0.547      -5.476       2.904
C(home)[T.1]                                                0.4842      0.152      3.189      0.001       0.187       0.782
C(saison)[T.reste]                                         -0.3675      0.157     -2.348      0.019      -0.674      -0.061
C(PK)[T.1]                                                  0.9196      0.221      4.153      0.000       0.486       1.354
C(PK)[T.2]                                                  2.4439      0.712      3.430      0.001       1.047       3.840
C(CrdR)[T.1]                                               -0.7592      0.273     -2.780      0.005      -1.294      -0.224
C(CrdR)[T.2]                                               -0.9926      0.960     -1.034      0.301      -2.874       0.888
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]    -0.1837      0.258     -0.713      0.476      -0.689       0.321
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]     0.1678      0.204      0.823      0.410      -0.232       0.567
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]     0.0493      0.229      0.215      0.830      -0.400       0.499
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]     0.2569      0.251      1.024      0.306      -0.235       0.749
age                                                         0.0969      0.081      1.200      0.230      -0.061       0.255
Poss                                                       -0.0497      0.010     -4.995      0.000      -0.069      -0.030
Dist                                                       -0.0301      0.027     -1.108      0.268      -0.083       0.023
SoT                                                         0.4726      0.047     10.146      0.000       0.381       0.564
diff_value                                                  0.0045      0.000     10.747      0.000       0.004       0.005
Int                                                         0.0253      0.018      1.408      0.159      -0.010       0.061
Sh                                                         -0.0954      0.021     -4.569      0.000      -0.136      -0.054
===========================================================================================================================
"""
Le 3-4-3 diminue les chances de victoires par rapport au 4-5-1 (pas significatif non plus...). Le 4-3-3 semble à peu près équivalent quant les 3-5-2 et le 4-4-2 reste plus prolifiques. Aucun des coeff n'est significatif mais la relation entre les systèmes est intéressante.


	VIF Factor		features
0	853.8478750880763		Intercept
1	1.0532799758911306		C(home)[T.1]
2	1.0266485465276423		C(saison)[T.reste]
3	1.044741646611513		C(PK)[T.1]
4	1.0404525985985305		C(PK)[T.2]
5	1.0290204619192416		C(CrdR)[T.1]
6	1.0071435908750428		C(CrdR)[T.2]
7	2.3821053928058014		C(opp_Formation)[T.3-5-2]
8	2.0179573731842817		C(opp_Formation)[T.4-3-3]
9	1.8609422807063412		C(opp_Formation)[T.4-4-2]
10	2.3526149077054685		C(opp_Formation)[T.4-5-1]
11	1.0163691550381686		age
12	1.6144857103646557		Poss
13	1.1304628615029992		Dist
14	1.8947546248115334		SoT
15	1.4608409734847072		diff_value
16	1.0504840162007816		Int
17	2.290348812104856		Sh

Concernant les variables rien d'inquiètant. Les valeur sont innférieurs à 10 (seuil technique de colinéarité). Il n'y a, à priori pas de soucis de multicolinéarité.
Par contre, la valeur dingue de l'intercept semblerait venir d'un soucis d'une des variables quali qui se comporterait comme une constante et qui, par conséquent serait reliée directement à l'intercept. Cela pourrait aussi venir de la part du modèle qui n'est pas expliqué ? Vu la valeur de mon R² c'est une piste que je vois bien. Après, comme il n'y a finalement que peu de cartons rouge par exemple, peut-être que le problème peu venir de là. Idem pour les penaltys. 

Les péno :
0    1017
1     141
2      14

Les cartons rouges :
0    1046
1     117
2       9

Pour palier ce problème, je peux déjà essayé avec les cartons jaunes à la place des rouges :
2    351
3    285
1    235
4    145
0     87
5     49
7      9
6      9
8      2

8 ???

Test avec cartons jaunes de la table Vif :
La valeur de l'intercept passe à 881. C'est pire !

Bon bah on va garder ce modèle.

##En attendant :

Stats descriptives de la table en sortie csv

Voir la création d'un indicateur de difficultés defensives et un de difficultés offensives ==> 
Ce qu'on a comme variables pour créer ça:
ATTAQUE
- nombre de frappes (positif) :: moyenne 12.75 ecart-type 5.72 mediane 12 max 46 75% 16
- nombre de tirs cadrés (positif) :: moyenne 4.24 ecart-type 2.51 mediane 4 max 16 75% 6
- possession (positif) :: moyenne 50.6 ecart-type 9.75 mediane 51 max 82 75% 57
- Distance de tirs (négatif) :: moyenne 17.7 ecart-type 3 mediane 17.6 max 32.4 min 7.7
- nombre de fautes provoquées :: moyenne 13.17 ecart-type 4 mediane 13 max 28
- et cartons (positifs) :: moyenne 2.5 ecart-type 1.5 mediane 2 max 9
- penalty (positifs) :: moyenne 0.15 ecart-type 0.39 mediane 0 max 3
- Int (positif) :: moyenne 10 ecart-type 4 mediane 10 max 28

DEFENSE
- nombre de fautes (negatif) :: moyenne 13 ecart-type 4.2 mediane 13 max 28
- nombre de penalty et coup francs encaissés (négatifs) :: moyenne 0.63 ecart-type 0.8 mediane 0 max 5
- nombre de cartons pris (négatif) :: moyenne 2.3 ecart-type 1.4 mediane 2
- nombre de tirs encaissés (négatif) :: moyenne 12.5 ecart-type 5.54 mediane 12 max 46 75% 16 

Dans la mesure où l'on a vu que la série A est un championnat avec plus d'équipes qui jouent en contre, dans lequel la possession n'est pas un signe de domination et dans lequel la défense est très importante, quels sont les stats les plus importantes pour évaluer la domination d'une équipe:

Si une équipe italienne est dominée alors il y a plus de chance que ce soit sa défense qui soit mise à mal.
Pour moi les valeurs qui vont le plus traduire ça sont :
- Nombre de tirs encaissés
- Nombre de fautes commises,
- Nombre de cartons pris 
- puis le nombre de coup franc et penaltys (encaissés) :: ils peuvent découler de faits de jeu, d'un arbitrage douteux

Si une équipe italienne domine un match elle n'a pas forcément le ballon mais elle sera plus souvent devant le but. Elle aura également plus de fautes mais aussi, et surtout sa défense sera meilleure :
- Nombre de frappes 
- Faiblesse de la distance de frappe (trouver un moyen de lier cette info avec le nombre de frappes)
- Nombre d'interception
- Nombre de fautes provoquées ou nombre de cartons provoqués
- Possession en dernier car pas pertinent ici

J'aimerais que cet indicateur puisse prendre la forme [-1 ; 1] avec -1 pour l'équipe totalement sous l'eau qui se fait marcher dessus et 1 pour l'équipe qui fait ce qu'elle veut en match et écrase l'autre. Bien sûr, il n'y aura jamais ces deux valeurs mais c'est cet interval qui m'interesse.
Ou alors, je peux créer deux indicateurs , le premier traduit les facilités/difficultés offensives et le second les facilités/difficultés offensives (pour les intégrer ensuite dans le modèle). Dans ce cas certaines variables passent de l'attaque à la défense (Interception notamment).

Exemple :
F/D défense :: Nombre d'interception - (nb de tirs encaissés + nb de fautes commises (nb de cartons) + nombre de coup de pied arrêtés encaissés)
F/D attaque :: Nombre de frappes + Nombre de fautes provoquées (ou cartons) + "possession" - distance de frappe  

Avec les moyennes :
FDD <- 10 - (12.5 + 13 + 0.63)

FDA <- 12.75 + 13 + 0.56 - 18

Il faut pondérer des trucs sinon ça va ressembler à rien et surtout , j'ai besoin de revaloriser les coup francs et penaltys encaissés (0.63).
Je pourrais tester de prendre la proportion de chaque stat par rapport au 3 eme quartile. Comme ça j'obtiens des indicateurs qui sont tous entre 0 et 1.quelque chose histoire de valoriser les perf incroyables.

FDD <- 0.75 - (0.75 + 0.6 + 0.6) -- moyenne = -1.2 -- max :: 0 - (2.9 + 1.75 + 5) = -9.65 -- min :: 2.15 - (0 + 0 + 0) = 2.15

FDA <- 0.75 + 0.6 + 0.7 - 0.9 -- moyenne 1.15 -- max :: 2.9 + 1.75 + 1.5 - 0.4 = 5.75 -- min :: 0 + 0 + 0.32 - 1.66 = -1.34

Les échelles sont pas les mêmes et les indicateurs ne sont pas comparables mais cette méthode de calcul me parait pas mal. Ajouté dans le modèle cela pourrait apporter des infos supplémentaires.

Top et flop dans la base 
top défense = Napoli avec un 1.00
pire défense = Bologna avec un -7.04

Top attaque = Roma avec un 3.94
Pire attaque = Genoa avec un -0.34

Top 5 defenses en moyenne sur les 3 saisons :
Atalanta 		-1.142113
Milan 		-1.144344
Napoli 		-1.163518
Lazio 		-1.221497
Fiorentina 	-1.267857

Pires défenses 

Venezia 		-2.284361
Salernitana 	-1.853888
Spezia 		-1.799311
Empoli 		-1.724529
Cagliari 		-1.694634

Top 5 attaques en moyenne :
Napoli  			1.953039
Internazionale  	1.819087
Atalanta  		1.812204
Milan  			1.774427
Sassuolo  		1.740468

Pires Attaques :

Venezia  		1.205397
Genoa  		1.278745
Spezia  		1.340549
Salernitana  	1.366890
Cagliari  	1.415780

Je m'apercois que je n'ai pas l'INTER ??? Ils disparaissent avec le dropna . A vérifier d'où ça vient (diff_value ??) == C'était un problème de nom dans la base d'origine (idem pour hellas verone).

recalcul du FDA avec l'ajout du pourcentage de passes réussies :

Meilleures attaques : 
Napoli  			2.967030
Internazionale  	2.819415
Atalanta  		2.768520
Sassuolo  		2.740186
Juventus  		2.739583

Pires attaques :
Cagliari  	2.302430
Spezia  		2.237433
Salernitana  	2.228053
Genoa  		2.128451
Venezia  		2.065401

L'Ac milan sort du top 5 je sais pas trop si c'est un bon signe
sur les 5 derniers c'est toujours les mêmes mais dans un ordre différent.

Meilleure perf : 4.91 par la Roma.

Si j'ajoute ces scores à la régression, il faut que je vire des variables histoire de pas faire doublons (nb de tirs etc ...).

A virer pour FDD == Int je crois et en plus y a pas de corrélation forte entre les deux donc peut-être la garder
A virer pour FDA == Poss et Cmp, Sh et peut-être Sot + forte corrélation avec diff_value

En croisant les formations dans la table vif je constate une colinéarité un peu élevée entre certaines formation 
(ex 10.4 de vif pour le 4-3-3 de l'opponent)

Je test un modèle avec FDA et FDD et le croisement des formations :

					victoire ~ C(home) + FDD + FDA + age + Dist + SoT + diff_value + Int + C(saison) + C(PK) + C(CrdR) + C(Formation)*C(opp_Formation, Treatment(reference="4-5-1"))

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1436
Model:                          Logit   Df Residuals:                     1398
Method:                           MLE   Df Model:                           37
Date:                Mon, 23 Jan 2023   Pseudo R-squ.:                  0.2617
Time:                        20:36:50   Log-Likelihood:                -698.10
converged:                       True   LL-Null:                       -945.56
Covariance Type:            nonrobust   LLR p-value:                 1.877e-81
=================================================================================================================================================
                                                                                    coef    std err          z      P>|z|      [0.025      0.975]
-------------------------------------------------------------------------------------------------------------------------------------------------
Intercept                                                                        -0.4973      1.998     -0.249      0.804      -4.414       3.420
C(home)[T.1]                                                                      0.3968      0.136      2.909      0.004       0.130       0.664
C(saison)[T.reste]                                                               -0.2923      0.141     -2.070      0.038      -0.569      -0.016
C(PK)[T.1]                                                                        1.0967      0.201      5.451      0.000       0.702       1.491
C(PK)[T.2]                                                                        2.4079      0.748      3.221      0.001       0.943       3.873
C(CrdR)[T.1]                                                                     -0.6439      0.255     -2.530      0.011      -1.143      -0.145
C(CrdR)[T.2]                                                                     -0.8260      0.940     -0.878      0.380      -2.669       1.017
C(Formation)[T.3-5-2]                                                            -0.0587      0.427     -0.137      0.891      -0.896       0.778
C(Formation)[T.4-3-3]                                                            -0.0081      0.478     -0.017      0.987      -0.944       0.928
C(Formation)[T.4-4-2]                                                            -0.0615      0.495     -0.124      0.901      -1.031       0.908
C(Formation)[T.4-5-1]                                                            -0.4750      0.445     -1.066      0.286      -1.348       0.398
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]                           0.0559      0.484      0.116      0.908      -0.893       1.004
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]                          -0.1821      0.444     -0.410      0.682      -1.052       0.688
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]                          -0.4049      0.572     -0.708      0.479      -1.526       0.716
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]                           0.4277      0.611      0.700      0.484      -0.769       1.625
C(Formation)[T.3-5-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]    -0.2832      0.607     -0.466      0.641      -1.473       0.907
C(Formation)[T.4-3-3]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]    -0.8655      0.788     -1.098      0.272      -2.411       0.680
C(Formation)[T.4-4-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]    -0.4683      0.814     -0.575      0.565      -2.064       1.128
C(Formation)[T.4-5-1]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]     0.3445      0.637      0.541      0.588      -0.903       1.592
C(Formation)[T.3-5-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]    -0.1455      0.559     -0.260      0.795      -1.242       0.951
C(Formation)[T.4-3-3]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]     0.3454      0.608      0.568      0.570      -0.847       1.537
C(Formation)[T.4-4-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]    -0.1321      0.676     -0.195      0.845      -1.457       1.193
C(Formation)[T.4-5-1]:C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]     0.6989      0.577      1.212      0.225      -0.431       1.829
C(Formation)[T.3-5-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]     0.1674      0.680      0.246      0.805      -1.165       1.500
C(Formation)[T.4-3-3]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]     0.7225      0.789      0.916      0.360      -0.823       2.268
C(Formation)[T.4-4-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]     0.3697      0.841      0.440      0.660      -1.279       2.018
C(Formation)[T.4-5-1]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]     0.6726      0.711      0.946      0.344      -0.721       2.066
C(Formation)[T.3-5-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]    -0.7300      0.745     -0.980      0.327      -2.190       0.730
C(Formation)[T.4-3-3]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]    -0.4090      0.856     -0.478      0.633      -2.088       1.269
C(Formation)[T.4-4-2]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]    -0.3485      0.959     -0.364      0.716      -2.228       1.531
C(Formation)[T.4-5-1]:C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]     0.3821      0.748      0.511      0.609      -1.083       1.847
FDD                                                                               0.2498      0.079      3.160      0.002       0.095       0.405
FDA                                                                              -1.2725      0.175     -7.292      0.000      -1.615      -0.930
age                                                                               0.1173      0.072      1.623      0.105      -0.024       0.259
Dist                                                                             -0.0878      0.026     -3.351      0.001      -0.139      -0.036
SoT                                                                               0.4183      0.037     11.408      0.000       0.346       0.490
diff_value                                                                        0.0038      0.000     10.794      0.000       0.003       0.005
Int                                                                               0.0288      0.017      1.647      0.100      -0.005       0.063
=================================================================================================================================================
"""

R² pas dingue, le LLH est à chier 

Le croisement de formation avec la meilleure p-value est le 4-5-1 de l'équipe contre le 3-5-2 de l'opposant avec 0.225 ce qui est mauvais.
FDA et FDD sont significatifs.
Les opp_formation ont des meilleures p-values même si elles restent élevées que les formation tout court.
 
retest:

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1436
Model:                          Logit   Df Residuals:                     1418
Method:                           MLE   Df Model:                           17
Date:                Mon, 23 Jan 2023   Pseudo R-squ.:                  0.2554
Time:                        20:43:13   Log-Likelihood:                -704.08
converged:                       True   LL-Null:                       -945.56
Covariance Type:            nonrobust   LLR p-value:                 7.338e-92
===========================================================================================================================
                                                              coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------------------------------
Intercept                                                  -0.1760      1.904     -0.092      0.926      -3.909       3.557
C(home)[T.1]                                                0.3982      0.135      2.948      0.003       0.133       0.663
C(saison)[T.reste]                                         -0.2714      0.138     -1.971      0.049      -0.541      -0.002
C(PK)[T.1]                                                  1.0925      0.199      5.502      0.000       0.703       1.482
C(PK)[T.2]                                                  2.4134      0.709      3.406      0.001       1.025       3.802
C(CrdR)[T.1]                                               -0.6135      0.251     -2.442      0.015      -1.106      -0.121
C(CrdR)[T.2]                                               -0.7850      0.917     -0.856      0.392      -2.582       1.012
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]    -0.0786      0.211     -0.372      0.710      -0.493       0.336
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]     0.0033      0.180      0.018      0.985      -0.349       0.355
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]    -0.0386      0.215     -0.180      0.857      -0.459       0.382
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]     0.2020      0.235      0.858      0.391      -0.259       0.664
FDD                                                         0.2517      0.078      3.235      0.001       0.099       0.404
FDA                                                        -1.2199      0.171     -7.134      0.000      -1.555      -0.885
age                                                         0.0935      0.066      1.407      0.160      -0.037       0.224
Dist                                                       -0.0864      0.025     -3.412      0.001      -0.136      -0.037
SoT                                                         0.4153      0.036     11.402      0.000       0.344       0.487
diff_value                                                  0.0038      0.000     10.787      0.000       0.003       0.004
Int                                                         0.0271      0.017      1.595      0.111      -0.006       0.060
===========================================================================================================================
"""

Sans Poss et Sh je perds en R²

Je recalcul le FDA sans Poss pour pouvoir récupérer la possession dans le modèle et sans Int car pas significatif

reg = smf.logit('victoire ~ C(home) + Poss + FDD + FDA + age + Dist + SoT + diff_value + C(saison) + C(PK) + C(CrdR) + C(opp_Formation, Treatment(reference="4-5-1"))',
                  data=df_reg).fit()


<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1436
Model:                          Logit   Df Residuals:                     1418
Method:                           MLE   Df Model:                           17
Date:                Mon, 23 Jan 2023   Pseudo R-squ.:                  0.2649
Time:                        20:49:41   Log-Likelihood:                -695.03
converged:                       True   LL-Null:                       -945.56
Covariance Type:            nonrobust   LLR p-value:                 1.141e-95
===========================================================================================================================
                                                              coef    std err          z      P>|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------------------------------------
Intercept                                                   0.6999      1.853      0.378      0.706      -2.931       4.331
C(home)[T.1]                                                0.3435      0.136      2.524      0.012       0.077       0.610
C(saison)[T.reste]                                         -0.2769      0.139     -1.994      0.046      -0.549      -0.005
C(PK)[T.1]                                                  1.0894      0.200      5.437      0.000       0.697       1.482
C(PK)[T.2]                                                  2.5643      0.723      3.547      0.000       1.148       3.981
C(CrdR)[T.1]                                               -0.6332      0.252     -2.509      0.012      -1.128      -0.139
C(CrdR)[T.2]                                               -0.7987      0.942     -0.848      0.397      -2.645       1.048
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-4-3]    -0.1218      0.213     -0.571      0.568      -0.540       0.296
C(opp_Formation, Treatment(reference="4-5-1"))[T.3-5-2]     0.0801      0.182      0.440      0.660      -0.276       0.436
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-3-3]    -0.0905      0.217     -0.417      0.676      -0.515       0.334
C(opp_Formation, Treatment(reference="4-5-1"))[T.4-4-2]     0.2518      0.237      1.063      0.288      -0.213       0.716
Poss                                                       -0.0611      0.009     -6.588      0.000      -0.079      -0.043
FDD                                                         0.3078      0.074      4.160      0.000       0.163       0.453
FDA                                                        -0.6250      0.218     -2.866      0.004      -1.052      -0.198
age                                                         0.0978      0.067      1.464      0.143      -0.033       0.229
Dist                                                       -0.0591      0.026     -2.243      0.025      -0.111      -0.007
SoT                                                         0.3880      0.037     10.540      0.000       0.316       0.460
diff_value                                                  0.0041      0.000     11.251      0.000       0.003       0.005
===========================================================================================================================
"""

Je récupère mon R²
Pas de soucis avec l'intercept non significatif.
Je garde les formations pour le moment mais ça commence à prendre forme.

Pour FDD et FDA :
formules 
data["FDD"] = (data["Int"]/(data.Int.quantile([0.75]).values)) - ((data["opp_Sh"]/(data.opp_Sh.quantile([0.75]).values)) + 
                                                (data["Fls"]/(data.Fls.quantile([0.75]).values)) + 
                                                (data["coup_arret"]/(data.coup_arret.quantile([0.75]).values)))

data["FDA"] = ((data["Sh"]/(data.Sh.quantile([0.75]).values)) + 
               (data["opp_fls"]/(data.opp_fls.quantile([0.75]).values)) + 
               (data["Cmp"]/(data.Cmp.quantile([0.75]).values))) - (data["Dist"]/(data.Dist.quantile([0.75]).values)) 

Lorsque FDD augmente les chances de victoires augmentent. 
Lorsque FDA augmente les chances de victoires diminuent ??? --> Ca c'est vraiment chelou car ca veut dire que plus je frappe de près et plus je réussi mes passes et plus je risque de perdre ?
DAFUK

Au passage, les coup de pieds arrêté et les tirs de l'adversaires ne sont pas significatifs tandis que les fautes de l'adversaire le sont.
Je ne l'ajoute pas car c'est déjà pris en compte dans le FDD !

##PROCHAINE ETAPE pour le modèle == INTEGRER DES VARIABLES SUR LE NIVEAU DES JOUEURS A CHAQUE POSTE 


Recherche des données par postes

Ce travail va nécessiter de nouvelles tables de données mais aussi des recherches sur les statistiques utiles pour évaluer la productivité des joueurs en fonction de leur poste puis pour les classer en fonction de leur centile de productivité par rapport aux autres joueurs du même poste 

!!!ACHTUNG ::: Se concentrer sur un seul championnat pour que les joueurs soient comparables --> En effet, si je venais à ajouter des joueurs de premiere league et de ligue 1 dans le classement en fonction de la productivité je viendrais totalement biaiser le résultat puisque la plupart de ces équipes ne jouent jamais les mêmes équipes que celles des autres championnats (hors LDC et europa league). 
Par conséquent, la productivité d'un attaquant de série A où le jeu est très défensif avec des grosses écuries européenne n'a rien à voir avec les performances d'un attaquant de ligue 1 (déso), championnat dans lequel les différences de niveaux sont encore trop marquées et où le jeu est moins défensif.

Par contre je risque d'avoir des petits échantillons du coup. Je vais partir sur les stats cumulées sur les saisons et les stats moyennes.
FBREF sera la source je pense.

Definition poste par poste pour voir les variables qui ont de l'intérêt.

Après, il faut simplifier un max pour pas trop démultiplier les postes et donc les observations.

Mon idée de base portant sur les milieux défensifs, je les garde tels quels.

Je groupe les défenseurs centraux entre eux
Je groupe les défenseurs latéraux
Je vais peut-être grouper les milieux centraux et les milieux offensifs même si les premiers doivent à priori plus être présent à la récupération tandis que les seconds sont plur en attaque
Je groupe les milieux latéraux
Je groupe les attaquants (ce ne sont vraiment pas l'objet de cette étude)
et je prends le gardien.

J'ai donc 7 groupes de postes pour lesquels je dois évaluer la productivité (je ne peux pas affirmer qu'un joueur est meilleur qu'un autre dans la mesure où ces stats ne reflètent pas forcément son talent et qu'il existe une infinité de facteurs qui peuvent abaisser la productivité chiffrable d'un joueur). Le but ici est vraiment de pouvoir distinguer la présence d'un joueur qui apporte beaucoup à un poste face à celui d'une autre équipe et d'en évaluer l'impact TCEPA.

Il faudra que je me penche sur les modèle où on peut bloquer les effets des autres postes. En effet, il y a de grandes chances qu'une équipe avec un très bon 6, ait également un bon 10, un bon 9 etc ... et inversement pour les clubs à plus petits budgets.

	MILIEUX DEFENSIFS

wiki :  ils sont là pour intercepter les ballons et briser l'attaque adverse.

decathlon : LA VISION D’UNE TOUR DE CONTRÔLE / UNE TECHNIQUE À LA BUSQUETS (> Je fais le minimum de touches de balles > Je fais une passe puis je me déplace pour proposer une solution > Je favorise le jeu en triangle, les appels contre-appels) / UNE GESTION DE L’EFFORT CALCULÉE AU MÈTRE PRÈS /  LE POSITIONNEMENT

footeo : On dit souvent d’un bon milieu défensif qu’il possède un “gros volume de jeu”, ce qui signifie qu’il est capable de multiplier les efforts et d’être toujours près du ballon.
Tous ses gestes - les conduites de balles, les passes courtes, les passes longues - doivent être les plus simples et précis possibles.

sport-equipement.fr : Ce sont sans doute les joueurs qui courent le plus pendant un match de foot. En effet, ils doivent tout faire ! Un milieu de terrain se doit d’empêcher la balle d’arriver dans les pieds de l’attaquant adverse, et à l’inverse, bien ajuster ses passes pour placer son attaquant dans les meilleures conditions possible.

Le placement et la lecture du jeu semblent être des notions qui sont difficiles à comptabiliser.
Cependant, en ce qui concerne le volume de jeu, la défense et les qualité technique je pourrais partir sur:
	
	- Nombre de km parcourus == Je le trouve pas sur FBREF
	- Nombre d'interceptions
	- %age de passes réussies
	- p-ê passes décisives
	- Tacles réussis

	- Nombre de cartons
	- Balles perdues 

	MILIEUX OFFENSIFS

wiki : Ils sont chargés d'organiser le jeu offensif de l'équipe. C'est le poste qui permet la meilleure expression du potentiel technique du joueur.

footeo : Si la qualité de dribble est très importante, elle est moins décisive si elle n’est pas accompagnée d’une grosse explosivité et d’une bonne vitesse de pointe / Si le sens du dribble est la qualité la plus évidente, il doit aussi être accompagné d’une bonne qualité de passe et de centre pour permettre d’être décisif 

Des gars technique quoi :
	
	- Nombre de dribbles (ou %age de réussis)
	- Nombre de passes réussies
	- Nombre de passes décisives
	- Nombre de buts sûrement
	- Nombre d'occasions créées

	- Balles perdues
	- Nombre de hors-jeu (placement)

	MILIEUX LATERAUX

wiki :le milieu de terrain est un joueur dont le rôle est de réaliser la liaison entre la défense et l'attaque. Après la récupération de la balle

Plusieures pages le confondent avec le milieu offensif (en plus ça doit dépendre des systèmes.) Du coup je vais utiliser les mêmes variables et supprimer cette catégorie.

	DEFENSEURS CENTRAUX

wiki : Les défenseurs (ou arrières) sont des joueurs de football dont la tâche principale consiste à perturber, ou idéalement empêcher, le jeu d'attaque de l'équipe adverse.

uniqueathlete : l’objectif principal d’un défenseur central de stopper les attaquants et d’empêcher à ce que les attaquants parviennent dans la surface de réparation ou parviennent à s’approcher trop près du but.  / Bon jeu aérien / 

Pas trop besoin d'aller plus loin :

	- Nombre de tacles
	- Nombre d'interceptions et/ou Blocks
	- Nombres de duels aériens gagnés
	
	- Fautes et cartons

	DEFENSEURS LATERAUX

On est un peu sur le même profil que les mecs d'avant
A priori c'est un défenseur qui cours plus souvent

	- Nombre de tacles
	- Interceptions ou Blocks
	- Duels aériens

On ajoute juste
	- Longues passes ou %age de passes réussies
	- %age de dribbles réussis

	- Fautes et cartons
	- Balles perdues

	GARDIEN

Il y a des tables spéciales gardiens sur FBREF:

	- % de "crosses" stopés par le gardien (feintes)
	- % de saves

	- Nombre de buts encaissés
	- Cartons ?

	ATTAQUANTS

Ben mettre des buts, dribbler et faire quelques passes décisives non ?

	- Nombre de buts
	- % de dribbles réussis
	- % de passes réussis 
	- Nombre d'actions créées
	- Nombre de tirs (cadrés ?)

	- Nombre de hors-jeu (placement)
	- Ballons perdus

Je vais devoir télécharger toutes les tables des stats par joueurs sur 90 minutes (== non en fait comme je fais des sommes de productiion de joueurs ja vais regarder comment je peux gérer ces tables) sur les saisons complètes dont je dispose (20 - 21 et  21 - 22) ==> Peut-être récupérer deux autres saisons ? Ou alors travailler sur une seule saison ?
Va falloir sortir une variable "saison" pour croiser les tables et avoir les bons effectifs.
	
Je test une table sur une saison

Finalement je DL toutes les tables en texte
Y a les gardiens dans tous les fichiers OKZOU

Avant de créer une table de tous les joueurs avec toutes les stats, je dois travailler rapidement chaque fichier (renommage de variables, création d'une clé de jointure etc...)
La clé de jointure c'est la variable "-9999"



























