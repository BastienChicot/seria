Modèle pertinent :

Ce qu'on veut montrer == nombre de frappes / buts par equipe et donc victoire et défaite

variables explicatives qui ont du sens  : 
	- possession (encore que ?) --> FBREF
	- contre attaque 
	- formation --> FBREF
	- coach     === ces deux derniers ont pour but de montrer le style de jeu et peut-être expliqueront-ils les occasions --TRANSFERMARKT
	- effectifs == valeur de l'effectif c'est un peu le seul truc que je peux avoir (notes fifa ?) --TRANSFERMARKT
	- fautes subies ou penaltys+coup francs == aggressivité, capacité à provoquer la faute (trop de faute provoquée s'expliquerait peut-être par une différence de niveau forte entre les équipes) --> FBREF
	- saves du gardien (par match ou par équipe ?) --> expliquerait la part liée au gardien !! ATTENTION cependant à ce que ça ne soit pas trop corrélé avec le nombre de frappes mais, expliquerait peut-être la qualité offensive d'une équipe ???
	- Forme == le repos est il pertinent entre deux matchs (sachant que dans le foot, peu d'équipe jouent plus de 2 matchs par semaine) et série en cours (aspect psychologique de l'équipe) --> A recalculer
	- age moyen de l'équipe == capacité à jouer fort contrebalancée par l'expérience , qui a le plus d'effet ? --> TRANSFERMARKT??
	- Période de l'année (certains joueurs plus endurants dans le froid ou plus performant dans le chaud ???) --> PARTOUT EN VRAI
	- Si possible, nombre de passes moyen par match ? mais pas sûr de la pertinence + doublon avec possession peut-être --> FBREF

Comment connaitre la valeur d'une équipe avant chaque match (avec les absents etc....) Le PSG sans neymar, Mbappé et Messi c'est toujours bien mais c'est moins fou ?
Attention à l'effet coach = 
La possession, le nombre de passe, le nombre de frappe, le nombre de save du gardien vont aussi dépendre du schéma de jeu. Par conséquent le fait d'introduire le coach et la formation de l'équipe dans l'équation pourrait créer une corrélation forte entre toutes ces variables .


Où trouver les données  ::
Problème de ESPN == URL avec des codes matchs sans logique évidente
Problème de Whoscored == Site protégé, impossible de scrapper 
Problème de récupérer les csv == Mise à jour ?
Problème des API == API complètes payantes
Problème de azscore ou xscore je sais plus == url avec logique d'id de match random comme espn 

Dans les csv de football-data.co.uk :
Equipes
Date
Nb de buts
Nb de tirs
Nb de tirs cadrés
Résultat
Fautes
Corner
Jaunes
Rouges

fbref !!! YOUHOU !!! mais pb d'url encore
codes url dans un fichier text

Dans les fichiers fbref scores & fixtures:
Date
Heure
Equipe
compétition
Home/Away
Résultat
Nombre de buts
Nombre de buts encaissés
Possession
Attendance
Capitaine
Formation Arbitre

Dans les fichiers fbref shoots:
Tirs
Tirs cadrés
Distance moyenne
Free kicks
Penaltys

Dans les fichiers fbref passing:
Passes complétées
% de passes réussies

Dans les fichiers defensive actions:
Tacles
interceptions

Dans les fichiers miscallenous stats:
Cartons jaunes
Cartons rouges
Fautes 
Hors jeu

Récup sur transfermarkt :
Galère == tables en js
Selenium plus retouches à la main pour obtenir un fichier correct et exploitable mais à ne faire qu'une fois par saison donc EZ


Comment exprimer concretement les variables :
Modèle ==>
Nombre de but / Victoire-Défaite = Date + Home/away + Possession + Formation + Tirs? + Distance moyenne + % de passes completées + interceptions + Tacles + Cartons + Fautes + Valeur equipe

Intégration de variable de l'adversaire ? --> Valeur equipe adverse , Formation equipe adverse

Nombre de buts ou Victoire == Resulat dans les bases FBREF

- Date == Ou période de l'année (peut-être ne garder que le mois / fonctionnait bien sur la NBA)
- Home/Away = Tel quel dans les bases FBREF
- Possession == Juste la possession de l'equipe (Voir s'il ne serait pas pertinent de la comparer avec la possession moyenne de la saison) dans FBREF
- Formation == Voir si il est bien pertinent de garder la formation sous forme de str --> Peut-être créer trois nouvelles variables = nb defenseurs, nb milieu, nb attaquants (seul problème, les formations type 4-2-3-1 mais peut être possible en faisant 11 - (nb_att + nb_def))
- Tirs : gros risque de corrélation avec la var a expliquée surtout si je garde le nombre de but. + tirs ou tirs cadrés ?
- Distance == FBREF, interessant mais potentiellement fortement correlée au nombre de tirs
- % de passes completées == tel quel dans FBREF
- interceptions == FBREF 
- Tacles == FBREF, voir la pertinence
- Cartons == Jaunes ou rouges ? voir pertinence également
- Fautes == soit cartons soit ça en gros
- valeur équipe == supprimer les caractères inutiles (€ et m)
- age
- valeur équipe adverse == idem
- formation équipe adverse == pareil (nb de défenseur etc...) 
- Nb de jours de repos == recalculer depuis FBREF

CORRELATION DES VARIABLES, OBSERVATIONS SUR LA SAISON 21 22 (a confirmer avec les données des autres saisons):
possession ==>
tirs cadrés : 0.39
cmp% : 0.57
repos : 0.46

age ==>
value : 0.18

tirs cardés ==>
possession : 0.39
cmp% : 0.33

distance ==>
tirs cadrés : 0.2

cmp% ==>
possession : 0.57
value : 0.47

int ==>
possession : -0.26
cmp% : -0.26

fls ==>
cmp% : -0.27

value ==> 
cmp% : 0.47

repos ==>
value : 0.17

opp_value ==>
possession : -0.38

VICTOIRE ==>
possession : 0.17
tirs cadrés : 0.41
cmp% : 0.18
value : 0.28
opp_value : -0.26 (s'annule avec la value) 

Il peut-être intéressant de travailler sur la différence de valeur plutôt que sur les valeurs directement

diff_value ==>
possession : 0.53
tirs cadrés : 0.33
cmp% : 0.34
VICTOIRE : 0.4

On garde la diff c'est mieux!
Test sur les équipes à domicile mais rien de fou 

le nombre de milieu et d'attaquant semble être plus corrélés à la victoire ou à la défaite(nul) que le nombre de défenseur. Voir avec la différence peut-être.

Pour les années précédente, je suis bloqué car je n'ai plus accès au site (access denied == robots). tester un autre jour ou sur un autre ordi. ==> j'ai été IP ban quelques temps car trop de requêtes en même temps. J'envoyais 3 URL quasi en même temps tous les 2 minutes du coup normal. CloudShare qui gere ça me renvoyait une erreur 1015 qui est un ban temporaire rien de grave. J'ai juste ajouter des time.sleep dans le script de scraping et je lance 1 année à la fois.

Matrice de corrélation pour les données de 2020 à 2023 :
Résultats les plus forts :
0.57 cmp% et possession
0.45 cmp% et value
0.39 victoire et tirs cadrés
0.45 diff value et possession
0.34 diff value et tirs cadrés
0.4 diff value et victoire
0.31 possession et tirs cadrés

Whatabout Victoire #ce qui nous intéresse
Majoritairement la valeur, les tirs cadrés, la possession et la distance moyenne de tir

Regressions tests:
Premier test : Explique la variable victoire

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1207
Model:                          Logit   Df Residuals:                     1193
Method:                           MLE   Df Model:                           13
Date:                Mon, 16 Jan 2023   Pseudo R-squ.:                  0.2226
Time:                        21:16:06   Log-Likelihood:                -616.79
converged:                       True   LL-Null:                       -793.43
Covariance Type:            nonrobust   LLR p-value:                 1.589e-67
===============================================================================
                  coef    std err          z      P>|z|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept      -0.2724   2.61e+07  -1.05e-08      1.000   -5.11e+07    5.11e+07
opp_att        -0.9054   2.61e+06  -3.48e-07      1.000   -5.11e+06    5.11e+06
opp_def        -0.9070   2.61e+06  -3.48e-07      1.000   -5.11e+06    5.11e+06
opp_milieu     -0.9117   2.61e+06   -3.5e-07      1.000   -5.11e+06    5.11e+06
home            0.3121      0.141      2.210      0.027       0.035       0.589
np.log(age)     2.7947      1.944      1.438      0.150      -1.015       6.604
Poss           -0.0635      0.010     -6.186      0.000      -0.084      -0.043
SoT             0.3157      0.034      9.220      0.000       0.249       0.383
Dist           -0.0141      0.025     -0.563      0.573      -0.063       0.035
Cmp             0.0175      0.015      1.174      0.240      -0.012       0.047
Int             0.0221      0.017      1.309      0.191      -0.011       0.055
Fls            -0.0044      0.019     -0.230      0.818      -0.042       0.033
diff_value      0.0044      0.000     11.186      0.000       0.004       0.005
repos           0.0032      0.013      0.236      0.813      -0.023       0.030
Mois            0.0089      0.019      0.481      0.631      -0.027       0.045
===============================================================================

Sans trop de surprise ce sont les différence de valeur, la possession et le nombre de tirs cadrés qui ressortent en premier. On note aussi un R² pas fou.
le log de l'age est bien plus significatif que lorsqu'il n'est pas en log
Du coup je teste les variables numériques en log (sauf peut etre home qui est déjà binaire et qui a plutot un bon score):

<class 'statsmodels.iolib.summary.Summary'>
"""
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               victoire   No. Observations:                 1207
Model:                          Logit   Df Residuals:                     1184
Method:                           MLE   Df Model:                           22
Date:                Mon, 16 Jan 2023   Pseudo R-squ.:                  0.2272
Time:                        21:25:15   Log-Likelihood:                -613.15
converged:                       True   LL-Null:                       -793.43
Covariance Type:            nonrobust   LLR p-value:                 5.401e-63
======================================================================================
                         coef    std err          z      P>|z|      [0.025      0.975]
--------------------------------------------------------------------------------------
Intercept             -8.1381      9.765     -0.833      0.405     -27.278      11.002
C(Mois)[T.2]           0.0573      0.314      0.182      0.855      -0.558       0.673
C(Mois)[T.3]           0.3247      0.334      0.973      0.330      -0.329       0.979
C(Mois)[T.4]           0.2078      0.290      0.716      0.474      -0.361       0.777
C(Mois)[T.5]          -0.0973      0.307     -0.317      0.751      -0.699       0.504
C(Mois)[T.8]          -0.2688      0.364     -0.739      0.460      -0.982       0.444
C(Mois)[T.9]           0.3498      0.298      1.174      0.241      -0.234       0.934
C(Mois)[T.10]          0.3297      0.279      1.183      0.237      -0.217       0.876
C(Mois)[T.11]          0.4311      0.296      1.455      0.146      -0.149       1.012
C(Mois)[T.12]         -0.1853      0.306     -0.606      0.545      -0.785       0.414
np.log(opp_att)        0.4855      0.909      0.534      0.593      -1.297       2.268
np.log(opp_def)        0.8889      1.994      0.446      0.656      -3.019       4.797
np.log(opp_milieu)     1.0511      2.003      0.525      0.600      -2.875       4.977
home                   0.3078      0.142      2.170      0.030       0.030       0.586
np.log(age)            2.9373      1.952      1.504      0.132      -0.889       6.764
np.log(Poss)          -3.0161      0.499     -6.047      0.000      -3.994      -2.039
SoT                    0.3222      0.035      9.313      0.000       0.254       0.390
np.log(Dist)          -0.2960      0.441     -0.672      0.502      -1.160       0.568
np.log(Cmp)            1.2560      1.147      1.096      0.273      -0.991       3.503
np.log(Int)            0.2092      0.156      1.344      0.179      -0.096       0.514
np.log(Fls)           -0.0139      0.239     -0.058      0.954      -0.483       0.455
diff_value             0.0044      0.000     11.191      0.000       0.004       0.005
np.log(repos)          0.0417      0.138      0.302      0.762      -0.229       0.312
======================================================================================
"""
R² toujours aussi nul

- home est pas mal
- log d'age mouais
- Possession toujours nickel
- Sot toujours nickel aussi
- diff_value toujours nickel
- Mois de novembre giga intéressant
- Meilleur score pour le nb d'attaquant, defenseurs et milieu mais je me demande si je ne devrais pas plutôt travailler sur les différences par postes entre les formations 
- Int et Cmp peut-être quelque chose à creuser aussi
- Fautes et repos à chier

En Machine Learning je pourrais plus facilement faire des modèles en fonction des équipes (même si en vrai elle transparaissent à travers leurs valeurs)

A refaire : tester d'autres types de modèles avant de partir en ML 
Créer des variables pour différencier les formations sans partir sur des trucs catégoriels trop chiants
Voir s'il n'y a pas d'autres variables dans la base d'origine qui pourraient être intéressantes à exploiter (peut-être en en modifiant la forme)